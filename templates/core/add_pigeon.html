{% extends 'base.html' %}

{% block title %}{% if pigeon %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å{% else %}–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ{% endif %} - –ì–æ–ª—É–±–ë–æ–∑–æ—Ä{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <h1 class="text-3xl md:text-4xl font-bold gold-text mb-8">
        {% if pigeon %}
        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        {% else %}
        –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        {% endif %}
    </h1>
    
    <div class="bg-[#1E1E1E] rounded-lg p-6 md:p-8 border border-gray-800">
        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            <!-- Listing Type (Radio Buttons) -->
            <div class="border-2 border-[#D4AF37] rounded-lg p-5 bg-[#121212]">
                <label class="block text-lg font-bold text-[#D4AF37] mb-4">
                    üìã –¢–∏–ø —Ä–∞–∑–º–µ—â–µ–Ω–∏—è *
                </label>
                <div class="space-y-3">
                    {% for choice_value, choice_label in form.listing_type.field.choices %}
                    <label class="flex items-center p-4 bg-[#1E1E1E] rounded-lg border-2 border-gray-700 hover:border-[#D4AF37] cursor-pointer transition group">
                        <input type="radio" name="listing_type" value="{{ choice_value }}" 
                               class="w-5 h-5 text-[#D4AF37] bg-[#121212] border-gray-600 focus:ring-[#D4AF37] focus:ring-2"
                               {% if form.listing_type.value == choice_value or choice_value == 'fixed' and not form.listing_type.value %}checked{% endif %}
                               onchange="toggleAuctionFields()">
                        <span class="ml-3 text-base font-medium text-gray-200 group-hover:text-[#D4AF37]">
                            {{ choice_label }}
                        </span>
                    </label>
                    {% endfor %}
                </div>
                {% if form.listing_type.errors %}
                    <p class="text-red-500 text-sm mt-2">{{ form.listing_type.errors.0 }}</p>
                {% endif %}
            </div>
            
            <!-- Auction Fee Warning (Hidden by default) -->
            <div id="auctionWarning" class="hidden border-2 border-red-600 bg-red-900/20 rounded-lg p-5">
                <div class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500 mr-3 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <div>
                        <p class="text-lg font-bold text-[#D4AF37] mb-1">‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</p>
                        <p class="text-base text-red-400 font-semibold">
                            –°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞: <span class="text-2xl text-[#D4AF37]">3 —Å–æ–º–æ–Ω–∏</span>
                        </p>
                        <p class="text-sm text-gray-400 mt-2">
                            –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≤–∞—à –∞—É–∫—Ü–∏–æ–Ω –±—É–¥–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Payment Instructions Box (Hidden by default) -->
            <div id="paymentBox" class="hidden border-2 border-[#D4AF37] bg-gradient-to-br from-[#1E1E1E] to-[#121212] rounded-lg p-6">
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-bold text-[#D4AF37] mb-3">üí≥ –û–ø–ª–∞—Ç–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞</h3>
                    <p class="text-gray-300 mb-4">–î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∞—É–∫—Ü–∏–æ–Ω–∞ –ø–µ—Ä–µ–≤–µ–¥–∏—Ç–µ <span class="text-[#D4AF37] font-bold text-xl">3 —Å–æ–º–æ–Ω–∏</span> –Ω–∞ –∫–æ—à–µ–ª–µ–∫:</p>
                    
                    <div class="bg-[#121212] border-2 border-[#D4AF37] rounded-lg p-5 mb-4 inline-block">
                        <p class="text-sm text-gray-400 mb-2">Alif / DC Money:</p>
                        <div class="flex items-center justify-center gap-3">
                            <p id="phoneNumber" class="text-3xl md:text-4xl font-bold text-[#D4AF37] tracking-wider">+992 888 788 181</p>
                            <button type="button" onclick="copyPhoneNumber()" class="px-4 py-2 bg-[#D4AF37] text-black font-semibold rounded-lg hover:bg-[#C5A028] transition">
                                üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Receipt Upload -->
                <div>
                    <label for="{{ form.payment_receipt.id_for_label }}" class="block text-base font-bold text-[#D4AF37] mb-3 text-center">
                        üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞ –æ–ø–ª–∞—Ç—ã *
                    </label>
                    {{ form.payment_receipt }}
                    {% if form.payment_receipt.errors %}
                        <p class="text-red-500 text-sm mt-2 text-center">{{ form.payment_receipt.errors.0 }}</p>
                    {% endif %}
                    <p class="text-xs text-gray-500 mt-2 text-center">
                        –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –µ–≥–æ
                    </p>
                </div>
            </div>
            
            <!-- Title -->
            <div>
                <label for="{{ form.title.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    –ù–∞–∑–≤–∞–Ω–∏–µ *
                </label>
                {{ form.title }}
                {% if form.title.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ form.title.errors.0 }}</p>
                {% endif %}
            </div>
            
            <!-- Breed, Game Type, Sex - Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <!-- Breed -->
                <div>
                    <label for="{{ form.breed.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                        –ü–æ—Ä–æ–¥–∞ *
                    </label>
                    {{ form.breed }}
                    {% if form.breed.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.breed.errors.0 }}</p>
                    {% endif %}
                </div>
                
                <!-- Game Type -->
                <div>
                    <label for="{{ form.game_type.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                        –¢–∏–ø *
                    </label>
                    {{ form.game_type }}
                    {% if form.game_type.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.game_type.errors.0 }}</p>
                    {% endif %}
                </div>
                
                <!-- Sex -->
                <div>
                    <label for="{{ form.sex.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                        –ü–æ–ª *
                    </label>
                    {{ form.sex }}
                    {% if form.sex.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.sex.errors.0 }}</p>
                    {% endif %}
                </div>
                
                <!-- City -->
                <div>
                    <label for="{{ form.city.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                        üèôÔ∏è –ì–æ—Ä–æ–¥ *
                    </label>
                    {{ form.city }}
                    {% if form.city.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.city.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Price (for Fixed listings) -->
            <div id="fixedPriceField">
                <label for="{{ form.price.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    üí∞ –¶–µ–Ω–∞ (TJS) *
                </label>
                {{ form.price }}
                {% if form.price.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ form.price.errors.0 }}</p>
                {% endif %}
            </div>
            
            <!-- Auction Fields (Hidden by default) -->
            <div id="auctionFields" class="hidden space-y-4 border-2 border-[#D4AF37] rounded-lg p-5 bg-[#121212]">
                <h3 class="text-lg font-bold text-[#D4AF37] mb-3">üî® –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–∫—Ü–∏–æ–Ω–∞</h3>
                
                <!-- Start Price -->
                <div>
                    <label for="{{ form.start_price.id_for_label }}" class="block text-sm font-semibold text-gray-300 mb-2">
                        –ù–∞—á–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (TJS) *
                    </label>
                    {{ form.start_price }}
                    {% if form.start_price.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.start_price.errors.0 }}</p>
                    {% endif %}
                    <p class="text-xs text-gray-500 mt-1">–° —ç—Ç–æ–π —Å—É–º–º—ã –Ω–∞—á–Ω—É—Ç—Å—è —Ç–æ—Ä–≥–∏</p>
                </div>
                
                <!-- Auction End Date -->
                <div>
                    <label for="{{ form.auction_end_date.id_for_label }}" class="block text-sm font-semibold text-gray-300 mb-2">
                        –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞ *
                    </label>
                    {{ form.auction_end_date }}
                    {% if form.auction_end_date.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.auction_end_date.errors.0 }}</p>
                    {% endif %}
                    <p class="text-xs text-gray-500 mt-1">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è –∞—É–∫—Ü–∏–æ–Ω</p>
                </div>
            </div>
            
            <!-- Description -->
            <div>
                <label for="{{ form.description.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    –û–ø–∏—Å–∞–Ω–∏–µ *
                </label>
                {{ form.description }}
                {% if form.description.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ form.description.errors.0 }}</p>
                {% endif %}
            </div>
            
            <!-- Main Cover Image -->
            <div>
                <label for="{{ form.image.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    üì∏ –ì–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ (–û–±–ª–æ–∂–∫–∞) *
                </label>
                {{ form.image }}
                {% if form.image.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ form.image.errors.0 }}</p>
                {% endif %}
                <p class="text-xs text-gray-500 mt-2">
                    ‚Ä¢ –≠—Ç–æ —Ñ–æ—Ç–æ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ —Å–ø–∏—Å–∫–µ<br>
                    ‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 1200x800px
                </p>
            </div>
            
            <!-- Multiple Extra Images Upload (Gallery) -->
            <div>
                <label for="{{ form.extra_images.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    üñºÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ (–ì–∞–ª–µ—Ä–µ—è - –¥–æ 5 —Ñ–æ—Ç–æ)
                </label>
                {% if pigeon and pigeon.images.all %}
                    <div class="mb-3 grid grid-cols-3 gap-2">
                        {% for img in pigeon.images.all %}
                        <img src="{{ img.image.url }}" alt="Image {{ forloop.counter }}" class="w-full h-24 object-cover rounded border-2 border-gray-700">
                        {% endfor %}
                    </div>
                    <p class="text-sm text-gray-400 mb-2">–¢–µ–∫—É—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å)</p>
                {% endif %}
                {{ form.extra_images }}
                {% if form.extra_images.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ form.extra_images.errors.0 }}</p>
                {% endif %}
                <p class="text-xs text-gray-500 mt-2">
                    ‚Ä¢ –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: –≤—ã–±–µ—Ä–∏—Ç–µ –¥–æ 5 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π<br>
                    ‚Ä¢ –≠—Ç–∏ —Ñ–æ—Ç–æ –±—É–¥—É—Ç –≤ –≥–∞–ª–µ—Ä–µ–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
                </p>
                <div id="imagePreview" class="mt-3 grid grid-cols-3 gap-2 hidden"></div>
            </div>
            
            <!-- Contact Information Section -->
            <div class="border-t border-gray-700 pt-6 mt-6">
                <h3 class="text-xl font-bold text-[#D4AF37] mb-4">üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                
                <div class="space-y-4">
                    <!-- Phone -->
                    <div>
                        <label for="{{ form.phone.id_for_label }}" class="block text-sm font-semibold text-gray-300 mb-2">
                            –¢–µ–ª–µ—Ñ–æ–Ω *
                        </label>
                        {{ form.phone }}
                        {% if form.phone.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.phone.errors.0 }}</p>
                        {% endif %}
                        <p class="text-xs text-gray-500 mt-1">–§–æ—Ä–º–∞—Ç: +992XXXXXXXXX</p>
                    </div>
                    
                    <!-- WhatsApp -->
                    <div>
                        <label for="{{ form.whatsapp_number.id_for_label }}" class="block text-sm font-semibold text-gray-300 mb-2">
                            WhatsApp (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                        </label>
                        {{ form.whatsapp_number }}
                        {% if form.whatsapp_number.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.whatsapp_number.errors.0 }}</p>
                        {% endif %}
                        <p class="text-xs text-gray-500 mt-1">–ù–æ–º–µ—Ä WhatsApp (—Ñ–æ—Ä–º–∞—Ç: +992XXXXXXXXX)</p>
                    </div>
                    
                    <!-- Telegram -->
                    <div>
                        <label for="{{ form.telegram_username.id_for_label }}" class="block text-sm font-semibold text-gray-300 mb-2">
                            Telegram (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                        </label>
                        {{ form.telegram_username }}
                        {% if form.telegram_username.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.telegram_username.errors.0 }}</p>
                        {% endif %}
                        <p class="text-xs text-gray-500 mt-1">–í–∞—à Telegram username –±–µ–∑ @ (–Ω–∞–ø—Ä–∏–º–µ—Ä: username)</p>
                    </div>
                </div>
            </div>
            
            <!-- Video URL -->
            <div>
                <label for="{{ form.video_url.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    üé• –í–∏–¥–µ–æ YouTube (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                </label>
                {{ form.video_url }}
                {% if form.video_url.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ form.video_url.errors.0 }}</p>
                {% endif %}
                <p class="text-xs text-gray-500 mt-1">
                    –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ
                </p>
            </div>
            
            <!-- VIP -->
            <div class="flex items-start space-x-3 p-4 bg-[#121212] rounded-lg">
                {{ form.is_vip }}
                <label for="{{ form.is_vip.id_for_label }}" class="text-sm text-gray-300 cursor-pointer">
                    <span class="font-semibold text-[#D4AF37] text-base">‚≠ê VIP —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ</span>
                    <span class="block text-xs text-gray-500 mt-1">–í–∞—à–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–æ –∑–æ–ª–æ—Ç–æ–π —Ä–∞–º–∫–æ–π –∏ –ø–æ–∫–∞–∑–∞–Ω–æ –ø–µ—Ä–≤—ã–º</span>
                    <a href="{% url 'vip_request' %}" class="text-[#D4AF37] hover:underline text-xs mt-1 inline-block">–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ VIP ‚Üí</a>
                </label>
            </div>
            
            <!-- Non-field errors -->
            {% if form.non_field_errors %}
                <div class="p-4 bg-red-900 border border-red-700 rounded-lg">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}
            
            <!-- Moderation Notice -->
            <div class="bg-blue-900/20 border border-blue-700/50 rounded-lg p-4">
                <div class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400 mr-3 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div>
                        <p class="text-sm text-blue-300 font-semibold mb-1">‚ÑπÔ∏è –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>
                        <p class="text-xs text-gray-400">
                            {% if pigeon %}
                            –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –º–æ–¥–µ—Ä–∞—Ü–∏—é.
                            {% else %}
                            –í–∞—à–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º (–æ–±—ã—á–Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤).
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Buttons -->
            <div class="flex flex-col sm:flex-row gap-3 pt-4">
                <button type="submit" id="submitButton" class="flex-1 px-6 py-3 bg-[#D4AF37] text-black font-bold rounded-lg hover:bg-[#C5A028] transition disabled:opacity-50 disabled:cursor-not-allowed">
                    {% if pigeon %}üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è{% else %}ÔøΩ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ª–æ—Ç{% endif %}
                </button>
                <a href="{% if pigeon %}{% url 'pigeon_detail' pigeon.pk %}{% else %}{% url 'home' %}{% endif %}" class="flex-1 text-center px-6 py-3 border-2 border-gray-700 text-gray-300 font-semibold rounded-lg hover:border-gray-600 transition">
                    –û—Ç–º–µ–Ω–∞
                </a>
            </div>
        </form>
    </div>
</div>

<!-- üí´ Loading Spinner Overlay (Dark Luxury) -->
<div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center">
    <div class="text-center">
        <!-- Animated Pigeon Icon -->
        <div class="mb-6 animate-bounce">
            <div class="text-8xl">ü¶Ö</div>
        </div>
        
        <!-- Loading Text -->
        <h2 class="text-3xl font-bold text-[#D4AF37] mb-3">
            –ó–∞–≥—Ä—É–∑–∫–∞...
        </h2>
        <p class="text-gray-300 text-lg">
            –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ
        </p>
        
        <!-- Spinner Animation -->
        <div class="mt-6 flex justify-center">
            <div class="w-16 h-16 border-4 border-[#D4AF37] border-t-transparent rounded-full animate-spin"></div>
        </div>
        
        <!-- Progress Hint -->
        <p class="text-sm text-gray-500 mt-4">
            –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...
        </p>
    </div>
</div>

<script>
function toggleAuctionFields() {
    const listingTypeInputs = document.querySelectorAll('input[name="listing_type"]');
    let selectedType = 'fixed';
    
    listingTypeInputs.forEach(input => {
        if (input.checked) {
            selectedType = input.value;
        }
    });
    
    const auctionWarning = document.getElementById('auctionWarning');
    const paymentBox = document.getElementById('paymentBox');
    const auctionFields = document.getElementById('auctionFields');
    const fixedPriceField = document.getElementById('fixedPriceField');
    
    if (selectedType === 'auction') {
        // Show auction elements
        auctionWarning.classList.remove('hidden');
        paymentBox.classList.remove('hidden');
        auctionFields.classList.remove('hidden');
        fixedPriceField.classList.add('hidden');
    } else {
        // Show fixed price elements
        auctionWarning.classList.add('hidden');
        paymentBox.classList.add('hidden');
        auctionFields.classList.add('hidden');
        fixedPriceField.classList.remove('hidden');
    }
}

function copyPhoneNumber() {
    const phoneNumber = '+992888788181';
    navigator.clipboard.writeText(phoneNumber).then(function() {
        // Show success feedback
        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
        button.classList.add('bg-green-600');
        button.classList.remove('bg-[#D4AF37]');
        
        setTimeout(function() {
            button.innerHTML = originalText;
            button.classList.remove('bg-green-600');
            button.classList.add('bg-[#D4AF37]');
        }, 2000);
    }, function(err) {
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é: +992 888 788 181');
    });
}

// üì∑ Image Preview Handler
function handleImagePreview() {
    const imageInput = document.querySelector('input[name="extra_images"]');
    const previewContainer = document.getElementById('imagePreview');
    
    if (!imageInput) return;
    
    imageInput.addEventListener('change', function(e) {
        const files = e.target.files;
        previewContainer.innerHTML = '';
        
        if (files.length > 5) {
            alert('‚ö†Ô∏è –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∞–∫—Å–∏–º—É–º 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π!');
            imageInput.value = '';
            previewContainer.classList.add('hidden');
            return;
        }
        
        if (files.length > 0) {
            previewContainer.classList.remove('hidden');
            
            Array.from(files).forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const div = document.createElement('div');
                    div.className = 'relative';
                    div.innerHTML = `
                        <img src="${e.target.result}" class="w-full h-24 object-cover rounded border-2 border-[#D4AF37]" alt="Preview ${index + 1}">
                        <span class="absolute top-1 left-1 bg-[#D4AF37] text-black text-xs font-bold px-2 py-1 rounded">${index + 1}</span>
                    `;
                    previewContainer.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        } else {
            previewContainer.classList.add('hidden');
        }
    });
}

// üí´ Loading Spinner Handler
function setupLoadingSpinner() {
    const form = document.querySelector('form');
    const submitButton = document.getElementById('submitButton');
    const loadingOverlay = document.getElementById('loadingOverlay');
    
    if (!form || !submitButton || !loadingOverlay) return;
    
    form.addEventListener('submit', function(e) {
        // Validate extra images count (optional gallery photos)
        const imageInput = document.querySelector('input[name="extra_images"]');
        
        if (imageInput && imageInput.files.length > 5) {
            e.preventDefault();
            alert('‚ö†Ô∏è –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∞–∫—Å–∏–º—É–º 5 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π!');
            return;
        }
        
        // Show loading overlay
        loadingOverlay.classList.remove('hidden');
        
        // Disable submit button
        submitButton.disabled = true;
        submitButton.textContent = '‚öôÔ∏è –û—Ç–ø—Ä–∞–≤–∫–∞...';
    });
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleAuctionFields();
    handleImagePreview();
    setupLoadingSpinner();
});
</script>
{% endblock %}
