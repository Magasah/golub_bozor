{% extends 'base.html' %}

{% block title %}{{ pigeon.title }} - –ì–æ–ª—É–±–ë–æ–∑–æ—Ä{% endblock %}

<!-- üîó Pigeon-specific Open Graph tags for rich social previews -->
{% block og_title %}{{ pigeon.title }} ‚Äî {% if pigeon.listing_type == 'auction' %}{{ pigeon.current_price }}{% else %}{{ pigeon.price }}{% endif %} TJS | –ì–æ–ª—É–±–ë–æ–∑–æ—Ä{% endblock %}

{% block og_description %}–ü—Ä–æ–¥–∞–µ—Ç—Å—è –≥–æ–ª—É–±—å –≤ {{ pigeon.location }}. –ü–æ—Ä–æ–¥–∞: {{ pigeon.get_breed_display }}. {% if pigeon.listing_type == 'auction' %}–ê—É–∫—Ü–∏–æ–Ω{% else %}–ü—Ä—è–º–∞—è –ø—Ä–æ–¥–∞–∂–∞{% endif %}. –ó–∞—Ö–æ–¥–∏ –Ω–∞ GolubBozor!{% endblock %}

{% block og_image %}{{ request.scheme }}://{{ request.get_host }}{{ pigeon.image.url }}{% endblock %}

{% block twitter_title %}{{ pigeon.title }} ‚Äî {% if pigeon.listing_type == 'auction' %}{{ pigeon.current_price }}{% else %}{{ pigeon.price }}{% endif %} TJS{% endblock %}

{% block twitter_description %}{{ pigeon.get_breed_display }} ‚Ä¢ {{ pigeon.location }} ‚Ä¢ {% if pigeon.listing_type == 'auction' %}–ê—É–∫—Ü–∏–æ–Ω{% else %}–ü—Ä–æ–¥–∞–∂–∞{% endif %}{% endblock %}

{% block twitter_image %}{{ request.scheme }}://{{ request.get_host }}{{ pigeon.image.url }}{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<div class="mb-6 flex flex-wrap items-center justify-between">
    <div>
        <a href="{% url 'home' %}" class="text-[#D4AF37] hover:underline">–ì–ª–∞–≤–Ω–∞—è</a>
        <span class="text-gray-600 mx-2">/</span>
        <span class="text-gray-400">{{ pigeon.title }}</span>
    </div>
    
    <!-- Views Counter -->
    <div class="flex items-center text-gray-400 text-sm mt-2 md:mt-0">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
        </svg>
        {{ pigeon.views_count }} –ø—Ä–æ—Å–º–æ—Ç—Ä{{ pigeon.views_count|pluralize:",–∞,–æ–≤" }}
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Left Column - Media & Details -->
    <div class="lg:col-span-2">
        <!-- VIP Badge -->
        {% if pigeon.is_vip %}
        <div class="bg-[#D4AF37] text-black text-center py-3 font-bold text-lg rounded-t-lg">
            ‚≠ê VIP –û–ë–™–Ø–í–õ–ï–ù–ò–ï ‚≠ê
        </div>
        {% endif %}
        
        <!-- Main Image with Lightbox -->
        <div class="{% if pigeon.is_vip %}border-4 border-[#D4AF37]{% else %}border border-gray-800{% endif %} rounded-lg overflow-hidden mb-6" data-aos="zoom-in">
            <a href="{{ pigeon.image.url }}" class="lightbox">
                <img 
                    src="{{ pigeon.image.url }}" 
                    alt="{{ pigeon.title }}"
                    class="w-full h-auto cursor-zoom-in hover:opacity-90 transition"
                >
            </a>
        </div>
        
        <!-- Action Buttons (Favorite & WhatsApp Share) -->
        <div class="grid grid-cols-2 gap-4 mb-6">
            <!-- Favorite Button -->
            {% if user.is_authenticated %}
            <button 
                onclick="toggleFavorite({{ pigeon.pk }}, this)"
                class="flex items-center justify-center px-4 py-3 border-2 rounded-lg font-semibold transition
                {% if is_favorited %}
                    border-red-500 text-red-500 bg-red-500/10 hover:bg-red-500/20
                {% else %}
                    border-gray-700 text-gray-300 hover:border-[#D4AF37] hover:text-[#D4AF37] hover:bg-[#D4AF37]/10
                {% endif %}"
                id="favorite-btn"
            >
                <span class="heart-icon flex">
                    {% if is_favorited %}
                    ‚ù§Ô∏è
                    {% else %}
                    ü§ç
                    {% endif %}
                </span>
                <span class="favorite-text ml-2">{% if is_favorited %}–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º{% else %}–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ{% endif %}</span>
            </button>
            {% else %}
            <a 
                href="{% url 'login' %}?next={{ request.path }}"
                class="flex items-center justify-center px-4 py-3 border-2 border-gray-700 text-gray-300 rounded-lg font-semibold hover:border-[#D4AF37] hover:text-[#D4AF37] hover:bg-[#D4AF37]/10 transition"
            >
                <span class="flex">ü§ç</span>
                <span class="ml-2">–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
            </a>
            {% endif %}
            
            <!-- WhatsApp Share Button -->
            <a 
                href="https://wa.me/?text=–°–∞–ª–∞–º!%20–ó–∞—Ü–µ–Ω–∏%20—ç—Ç–æ–≥–æ%20–≥–æ–ª—É–±—è:%20{{ pigeon.title|urlencode }}%20–∑–∞%20{% if pigeon.listing_type == 'auction' %}{{ pigeon.current_price }}{% else %}{{ pigeon.price }}{% endif %}%20TJS.%20–°—Å—ã–ª–∫–∞:%20{{ request.build_absolute_uri }}"
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-center justify-center px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition shadow-lg hover:shadow-xl"
            >
                <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                </svg>
                –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ WhatsApp
            </a>
        </div>
        
        <!-- Pigeon Details Grid -->
        <div class="bg-[#1E1E1E] rounded-lg p-6 border border-gray-800 mb-6">
            <h2 class="text-2xl font-bold mb-4 gold-text">üìã –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="bg-[#121212] p-4 rounded-lg">
                    <p class="text-gray-500 text-sm mb-1">–ü–æ—Ä–æ–¥–∞</p>
                    <p class="text-gray-200 font-semibold text-lg">{{ pigeon.get_breed_display }}</p>
                </div>
                <div class="bg-[#121212] p-4 rounded-lg">
                    <p class="text-gray-500 text-sm mb-1">–ü–æ–ª</p>
                    <p class="text-gray-200 font-semibold text-lg">{{ pigeon.get_sex_display }}</p>
                </div>
                <div class="bg-[#121212] p-4 rounded-lg">
                    <p class="text-gray-500 text-sm mb-1">üèôÔ∏è –ì–æ—Ä–æ–¥</p>
                    <p class="text-gray-200 font-semibold text-lg">{{ pigeon.get_city_display }}</p>
                </div>
                <div class="bg-[#121212] p-4 rounded-lg">
                    <p class="text-gray-500 text-sm mb-1">–¢–∏–ø/–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</p>
                    <p class="text-gray-200 font-semibold text-lg">{{ pigeon.get_game_type_display }}</p>
                </div>
            </div>
        </div>
        
        <!-- Video Section with Smart Button -->
        {% if pigeon.video_url %}
        <div class="bg-[#1E1E1E] rounded-lg p-6 border border-gray-800 mb-6">
            <h2 class="text-2xl font-bold mb-4 gold-text">üé• –í–∏–¥–µ–æ</h2>
            <p class="text-gray-400 mb-4 text-sm">–î–æ—Å—Ç—É–ø–Ω–∞ –≤–∏–¥–µ–æ-–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è —ç—Ç–æ–≥–æ –≥–æ–ª—É–±—è</p>
            
            <!-- Smart Video Button (Dark Luxury Style) -->
            <a 
                href="{{ pigeon.video_url }}" 
                target="_blank" 
                rel="noopener noreferrer"
                class="group relative flex items-center justify-center w-full px-6 py-4 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white rounded-lg font-bold text-lg transition-all duration-300 shadow-lg hover:shadow-2xl hover:scale-[1.02] overflow-hidden"
            >
                <!-- Animated background shine effect -->
                <span class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"></span>
                
                <!-- Button content -->
                <svg class="h-6 w-6 mr-3 relative z-10" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z"/>
                </svg>
                <span class="relative z-10">üé• –°–º–æ—Ç—Ä–µ—Ç—å –í–∏–¥–µ–æ</span>
                <svg class="h-5 w-5 ml-2 relative z-10 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                </svg>
            </a>
            
            <!-- Video platform hint -->
            <div class="mt-3 text-center text-xs text-gray-500">
                {% if 'youtube' in pigeon.video_url or 'youtu.be' in pigeon.video_url %}
                    <span class="inline-flex items-center">
                        <svg class="h-4 w-4 mr-1 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                        </svg>
                        YouTube
                    </span>
                {% else %}
                    <span>–í–Ω–µ—à–Ω—è—è —Å—Å—ã–ª–∫–∞</span>
                {% endif %}
            </div>
        </div>
        {% endif %}
        
        <!-- Description -->
        <div class="bg-[#1E1E1E] rounded-lg p-6 border border-gray-800">
            <h2 class="text-2xl font-bold mb-4 gold-text">üìù –û–ø–∏—Å–∞–Ω–∏–µ</h2>
            <p class="text-gray-300 leading-relaxed whitespace-pre-line">{{ pigeon.description }}</p>
        </div>
    </div>
    
    <!-- Right Column - Price & Contact -->
    <div class="lg:col-span-1">
        <div class="bg-[#1E1E1E] rounded-lg p-6 border border-gray-800 sticky top-20">
            
            {% if pigeon.listing_type == 'auction' %}
                <!-- ==================== AUCTION MODE ==================== -->
                <div class="mb-6 pb-6 border-b border-[#D4AF37]">
                    <!-- Auction Badge -->
                    <div class="bg-gradient-to-r from-[#D4AF37] to-[#F4BF47] text-black text-center py-3 rounded-lg mb-6 font-bold text-lg shadow-lg animate-pulse">
                        üî® –ñ–ò–í–û–ô –ê–£–ö–¶–ò–û–ù üî®
                    </div>
                    
                    <!-- Current Highest Bid -->
                    <div class="text-center mb-6">
                        <p class="text-gray-400 text-sm uppercase tracking-wider mb-2">–¢–µ–∫—É—â–∞—è –°—Ç–∞–≤–∫–∞</p>
                        <p class="text-5xl md:text-6xl font-black gold-text leading-none" style="text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);">
                            {{ pigeon.current_price|default:pigeon.start_price }}
                        </p>
                        <p class="text-[#D4AF37] text-2xl font-bold mt-2">TJS</p>
                    </div>
                    
                    <!-- Countdown Timer -->
                    <div class="bg-[#121212] rounded-lg p-4 mb-6 border border-[#D4AF37]">
                        <p class="text-gray-400 text-xs uppercase text-center mb-3">–û–∫–æ–Ω—á–∞–Ω–∏–µ —á–µ—Ä–µ–∑:</p>
                        <div id="countdown-timer" class="grid grid-cols-4 gap-2 text-center" data-end="{{ pigeon.auction_end_date|date:'c' }}">
                            <div>
                                <div class="text-3xl font-black gold-text" id="days">00</div>
                                <div class="text-xs text-gray-500 mt-1">–î–ù–ï–ô</div>
                            </div>
                            <div>
                                <div class="text-3xl font-black gold-text" id="hours">00</div>
                                <div class="text-xs text-gray-500 mt-1">–ß–ê–°–û–í</div>
                            </div>
                            <div>
                                <div class="text-3xl font-black gold-text" id="minutes">00</div>
                                <div class="text-xs text-gray-500 mt-1">–ú–ò–ù–£–¢</div>
                            </div>
                            <div>
                                <div class="text-3xl font-black gold-text" id="seconds">00</div>
                                <div class="text-xs text-gray-500 mt-1">–°–ï–ö–£–ù–î</div>
                            </div>
                        </div>
                        <div id="auction-status" class="text-center mt-3 hidden">
                            <span class="text-red-500 font-bold text-lg">‚è∞ –ê–£–ö–¶–ò–û–ù –ó–ê–í–ï–†–®–Å–ù</span>
                        </div>
                    </div>
                    
                    <!-- Auction Info Grid -->
                    <div class="space-y-2 text-sm mb-6">
                        <div class="flex justify-between bg-[#121212] p-3 rounded">
                            <span class="text-gray-500">–ù–∞—á–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞:</span>
                            <span class="text-gray-200 font-semibold">{{ pigeon.start_price }} TJS</span>
                        </div>
                        <div class="flex justify-between bg-[#121212] p-3 rounded">
                            <span class="text-gray-500">–í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫:</span>
                            <span class="text-[#D4AF37] font-bold">{{ pigeon.get_bid_count }}</span>
                        </div>
                        <div class="flex justify-between bg-[#121212] p-3 rounded">
                            <span class="text-gray-500">–°—Ç–∞—Ç—É—Å:</span>
                            {% if pigeon.is_auction_active %}
                                <span class="text-green-500 font-semibold flex items-center">
                                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                                    –ê–∫—Ç–∏–≤–µ–Ω
                                </span>
                            {% else %}
                                <span class="text-red-500 font-semibold">–ó–∞–≤–µ—Ä—à—ë–Ω</span>
                            {% endif %}
                        </div>
                        {% if pigeon.winner and not pigeon.is_auction_active %}
                        <div class="flex justify-between bg-[#121212] p-3 rounded">
                            <span class="text-gray-500">üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å:</span>
                            <span class="text-[#D4AF37] font-bold">{{ pigeon.winner.username }}</span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- BID FORM - Only show if user is authenticated, not owner, and auction is active -->
                    {% if user.is_authenticated and pigeon.is_auction_active and user != pigeon.owner %}
                    <div id="bid-form-container" class="p-5 bg-gradient-to-br from-[#121212] to-[#1A1A1A] rounded-xl border-2 border-[#D4AF37] shadow-xl">
                        <h4 class="text-xl font-bold mb-4 text-[#D4AF37] flex items-center">
                            <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
                            </svg>
                            –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É
                        </h4>
                        <form method="post" action="{% url 'place_bid' pigeon.pk %}" id="bid-form">
                            {% csrf_token %}
                            <div class="mb-4">
                                <label class="block text-gray-300 text-sm font-semibold mb-2">
                                    –í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ (TJS)
                                </label>
                                <input 
                                    type="number" 
                                    name="amount" 
                                    step="0.01" 
                                    min="{{ pigeon.current_price|default:pigeon.start_price|add:1 }}"
                                    class="w-full px-4 py-3 bg-[#0A0A0A] border-2 border-[#D4AF37] rounded-lg text-white text-lg font-bold focus:outline-none focus:ring-2 focus:ring-[#D4AF37] focus:border-transparent"
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É"
                                    required
                                >
                                {% if bid_form.amount.help_text %}
                                <p class="text-gray-400 text-xs mt-2 flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                    {{ bid_form.amount.help_text }}
                                </p>
                                {% endif %}
                                {% if bid_form.amount.errors %}
                                <p class="text-red-400 text-sm mt-2">{{ bid_form.amount.errors.0 }}</p>
                                {% endif %}
                            </div>
                            <button 
                                type="submit" 
                                id="bid-submit-btn"
                                class="w-full px-6 py-4 bg-gradient-to-r from-[#D4AF37] to-[#F4BF47] text-black font-black text-lg rounded-lg hover:from-[#C5A028] hover:to-[#E5B038] transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-2xl flex items-center justify-center"
                            >
                                <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                –°–î–ï–õ–ê–¢–¨ –°–¢–ê–í–ö–£
                            </button>
                        </form>
                    </div>
                    {% elif not user.is_authenticated and pigeon.is_auction_active %}
                    <!-- Not logged in -->
                    <div class="p-6 bg-[#121212] rounded-xl border-2 border-gray-700 text-center">
                        <svg class="w-16 h-16 mx-auto mb-4 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                        </svg>
                        <p class="text-gray-400 mb-4 text-lg">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏</p>
                        <a href="{% url 'login' %}?next={{ request.path }}" class="inline-block px-8 py-3 bg-[#D4AF37] text-black font-bold rounded-lg hover:bg-[#C5A028] transition transform hover:scale-105">
                            –í–æ–π—Ç–∏
                        </a>
                    </div>
                    {% elif user == pigeon.owner and pigeon.is_auction_active %}
                    <!-- Owner can't bid -->
                    <div class="p-6 bg-[#121212] rounded-xl border-2 border-gray-700 text-center">
                        <svg class="w-16 h-16 mx-auto mb-4 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z" clip-rule="evenodd"/>
                        </svg>
                        <p class="text-gray-400 text-lg">–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏ –Ω–∞ —Å–≤–æ–π –∞—É–∫—Ü–∏–æ–Ω</p>
                    </div>
                    {% endif %}
                </div>
                
                <!-- BID HISTORY -->
                {% if bids %}
                <div class="mb-6 pb-6 border-b border-gray-700">
                    <h3 class="text-xl font-bold mb-4 text-gray-200 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-[#D4AF37]" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                        </svg>
                        –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫ ({{ bids|length }})
                    </h3>
                    <div class="space-y-2 max-h-80 overflow-y-auto custom-scrollbar">
                        {% for bid in bids %}
                        <div class="flex justify-between items-center p-3 bg-[#121212] rounded-lg border border-gray-800 hover:border-[#D4AF37] transition">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-gradient-to-br from-[#D4AF37] to-[#C5A028] rounded-full flex items-center justify-center text-black font-bold mr-3">
                                    {{ bid.user.username|first|upper }}
                                </div>
                                <div>
                                    <p class="text-gray-200 font-semibold">{{ bid.user.username }}</p>
                                    <p class="text-gray-500 text-xs">{{ bid.created_at|timesince }} –Ω–∞–∑–∞–¥</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-[#D4AF37] font-black text-xl">{{ bid.amount }}</p>
                                <p class="text-gray-400 text-xs">TJS</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
            {% else %}
                <!-- ==================== FIXED PRICE MODE ==================== -->
                <!-- FIXED PRICE MODE -->
                <div class="mb-6 pb-6 border-b border-gray-700">
                    <div class="bg-blue-600 text-white text-center py-2 rounded-lg mb-4 font-bold">
                        üí∞ –§–ò–ö–°–ò–†–û–í–ê–ù–ù–ê–Ø –¶–ï–ù–ê
                    </div>
                    <p class="text-gray-500 text-sm mb-2">–¶–µ–Ω–∞</p>
                    <p class="text-4xl md:text-5xl font-bold gold-text">{{ pigeon.price }}</p>
                    <p class="text-gray-400 text-lg mt-1">TJS</p>
                </div>
            {% endif %}
            
            <!-- Seller Info -->
            <div class="mb-6 pb-6 border-b border-gray-700">
                <h3 class="text-lg font-semibold mb-3 text-gray-300">–ü—Ä–æ–¥–∞–≤–µ—Ü</h3>
                <a href="{% url 'seller_profile' pigeon.owner.username %}" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-[#2A2A2A] transition group">
                    <div class="w-12 h-12 bg-[#D4AF37] rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-black font-bold text-xl">{{ pigeon.owner.username|first|upper }}</span>
                    </div>
                    <div>
                        <p class="text-gray-200 font-semibold group-hover:text-[#D4AF37] transition">{{ pigeon.owner.username }}</p>
                        <p class="text-gray-500 text-sm">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ‚Üí</p>
                    </div>
                </a>
            </div>
            
            <!-- Contact Buttons -->
            <div class="space-y-3">
                <h3 class="text-lg font-semibold mb-3 text-gray-300">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                
                <!-- Phone -->
                <a href="tel:{{ pigeon.phone }}" class="flex items-center justify-center px-4 py-3 bg-[#D4AF37] text-black font-bold rounded-lg hover:bg-[#C5A028] transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                    </svg>
                    {{ pigeon.phone }}
                </a>
                
                <!-- WhatsApp -->
                {% if pigeon.whatsapp_number %}
                <a href="https://wa.me/{{ pigeon.whatsapp_number|cut:'+' }}" target="_blank" class="flex items-center justify-center px-4 py-3 bg-[#25D366] text-white font-semibold rounded-lg hover:bg-[#20BA5A] transition">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                    </svg>
                    WhatsApp
                </a>
                {% endif %}
                
                <!-- Telegram -->
                {% if pigeon.telegram_username %}
                <a href="https://t.me/{{ pigeon.telegram_username }}" target="_blank" class="flex items-center justify-center px-4 py-3 bg-[#0088cc] text-white font-semibold rounded-lg hover:bg-[#0077b3] transition">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                    </svg>
                    Telegram
                </a>
                {% endif %}
            </div>
            
            <!-- Date Published -->
            <div class="mt-6 pt-6 border-t border-gray-700">
                <p class="text-gray-500 text-sm">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</p>
                <p class="text-gray-300 font-semibold">{{ pigeon.created_at|date:"d.m.Y –≤ H:i" }}</p>
            </div>
            
            <!-- Edit/Delete for Owner -->
            {% if user == pigeon.owner %}
            <div class="mt-6 space-y-2">
                <a href="{% url 'edit_pigeon' pigeon.pk %}" class="block text-center px-4 py-2 border-2 border-[#D4AF37] text-[#D4AF37] font-semibold rounded-lg hover:bg-[#D4AF37] hover:text-black transition">
                    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                </a>
                <a href="{% url 'delete_pigeon' pigeon.pk %}" class="block text-center px-4 py-2 border-2 border-red-600 text-red-600 font-semibold rounded-lg hover:bg-red-600 hover:text-white transition">
                    –£–¥–∞–ª–∏—Ç—å
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Back Button -->
<div class="mt-8">
    <a href="{% url 'home' %}" class="inline-flex items-center text-[#D4AF37] hover:text-[#C5A028] transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É
    </a>
</div>

<!-- Auction Countdown Script -->
<!-- Auction Countdown Timer Script -->
<style>
/* Custom scrollbar for bid history */
.custom-scrollbar::-webkit-scrollbar {
    width: 8px;
}
.custom-scrollbar::-webkit-scrollbar-track {
    background: #121212;
    border-radius: 4px;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
    background: #D4AF37;
    border-radius: 4px;
}
.custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #C5A028;
}

/* Pulse animation for live indicator */
@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.5;
    }
}
</style>

<script>
// Toggle Favorite Function
function toggleFavorite(pigeonId, button) {
    fetch(`/pigeon/${pigeonId}/favorite/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
        credentials: 'same-origin'
    })
    .then(response => response.json())
    .then(data => {
        if (data.is_favorited) {
            // Update to favorited state
            button.classList.remove('border-gray-700', 'text-gray-300');
            button.classList.add('border-red-500', 'text-red-500', 'bg-red-500/10');
            button.querySelector('.heart-icon').innerHTML = '‚ù§Ô∏è';
            button.querySelector('.favorite-text').textContent = '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º';
        } else {
            // Update to unfavorited state
            button.classList.remove('border-red-500', 'text-red-500', 'bg-red-500/10');
            button.classList.add('border-gray-700', 'text-gray-300');
            button.querySelector('.heart-icon').innerHTML = 'ü§ç';
            button.querySelector('.favorite-text').textContent = '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
        }
    })
    .catch(error => {
        console.error('Error toggling favorite:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    });
}

document.addEventListener('DOMContentLoaded', function() {
    // Auction Countdown Timer
    const timerContainer = document.getElementById('countdown-timer');
    
    if (timerContainer) {
        const endDateStr = timerContainer.dataset.end;
        const endDate = new Date(endDateStr);
        
        const daysEl = document.getElementById('days');
        const hoursEl = document.getElementById('hours');
        const minutesEl = document.getElementById('minutes');
        const secondsEl = document.getElementById('seconds');
        const statusEl = document.getElementById('auction-status');
        const bidFormContainer = document.getElementById('bid-form-container');
        const bidSubmitBtn = document.getElementById('bid-submit-btn');
        
        function updateCountdown() {
            const now = new Date();
            const diff = endDate - now;
            
            if (diff <= 0) {
                // Auction ended
                if (daysEl) daysEl.textContent = '00';
                if (hoursEl) hoursEl.textContent = '00';
                if (minutesEl) minutesEl.textContent = '00';
                if (secondsEl) secondsEl.textContent = '00';
                
                if (statusEl) {
                    statusEl.classList.remove('hidden');
                }
                
                if (bidFormContainer) {
                    bidFormContainer.style.opacity = '0.5';
                    bidFormContainer.style.pointerEvents = 'none';
                }
                
                if (bidSubmitBtn) {
                    bidSubmitBtn.disabled = true;
                    bidSubmitBtn.textContent = 'üîí –ê–£–ö–¶–ò–û–ù –ó–ê–í–ï–†–®–Å–ù';
                    bidSubmitBtn.classList.add('cursor-not-allowed', 'opacity-50');
                }
                
                return;
            }
            
            // Calculate time units
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            // Update DOM with leading zeros
            if (daysEl) daysEl.textContent = String(days).padStart(2, '0');
            if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
            if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
            if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
            
            // Visual urgency effects
            if (diff < 3600000) { // Less than 1 hour
                timerContainer.classList.add('animate-pulse');
                if (daysEl) daysEl.classList.add('text-red-500');
                if (hoursEl) hoursEl.classList.add('text-red-500');
                if (minutesEl) minutesEl.classList.add('text-red-500');
                if (secondsEl) secondsEl.classList.add('text-red-500');
            } else if (diff < 86400000) { // Less than 24 hours
                if (hoursEl) hoursEl.classList.add('text-yellow-500');
                if (minutesEl) minutesEl.classList.add('text-yellow-500');
            }
        }
        
        // Initial update
        updateCountdown();
        
        // Update every second
        setInterval(updateCountdown, 1000);
    }
    
    // Bid form validation enhancement
    const bidForm = document.getElementById('bid-form');
    if (bidForm) {
        bidForm.addEventListener('submit', function(e) {
            const submitBtn = document.getElementById('bid-submit-btn');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<svg class="animate-spin h-5 w-5 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> –û—Ç–ø—Ä–∞–≤–∫–∞...';
            }
        });
    }
});
</script>

<!-- Q&A / Comments Section -->
<div class="mt-12 max-w-4xl mx-auto">
    <div class="bg-[#1E1E1E] border-2 border-[#D4AF37] rounded-lg p-6">
        <h2 class="text-3xl font-bold text-[#D4AF37] mb-6 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
            </svg>
            –í–æ–ø—Ä–æ—Å—ã –∏ –û—Ç–≤–µ—Ç—ã
        </h2>
        
        <!-- Comment Form -->
        {% if user.is_authenticated %}
        <div class="mb-8 bg-[#121212] rounded-lg p-5 border border-gray-700">
            <form method="post" class="space-y-4">
                {% csrf_token %}
                <div>
                    <label for="{{ comment_form.text.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                        üí¨ –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ–¥–∞–≤—Ü—É
                    </label>
                    {{ comment_form.text }}
                    {% if comment_form.text.errors %}
                        <p class="text-red-500 text-sm mt-2">{{ comment_form.text.errors.0 }}</p>
                    {% endif %}
                </div>
                <button type="submit" class="w-full px-6 py-3 bg-[#D4AF37] text-black font-bold rounded-lg hover:bg-[#C5A028] transition">
                    üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                </button>
            </form>
        </div>
        {% else %}
        <div class="mb-8 bg-blue-900/20 border border-blue-700/50 rounded-lg p-5 text-center">
            <p class="text-gray-300 mb-3">–ß—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</p>
            <a href="{% url 'login' %}?next={{ request.path }}" class="inline-block px-6 py-3 bg-[#D4AF37] text-black font-bold rounded-lg hover:bg-[#C5A028] transition">
                üîë –í–æ–π—Ç–∏
            </a>
        </div>
        {% endif %}
        
        <!-- Comments List -->
        <div class="space-y-4">
            {% if comments %}
                {% for comment in comments %}
                <div class="bg-[#121212] rounded-lg p-5 border border-gray-700 hover:border-[#D4AF37] transition">
                    <div class="flex items-start">
                        <!-- User Avatar -->
                        <div class="flex-shrink-0 mr-4">
                            <div class="w-12 h-12 rounded-full bg-[#D4AF37] flex items-center justify-center text-black font-bold text-xl">
                                {{ comment.user.username|slice:":1"|upper }}
                            </div>
                        </div>
                        
                        <!-- Comment Content -->
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-2">
                                    <span class="font-bold text-[#D4AF37]">{{ comment.user.username }}</span>
                                    {% if comment.user == pigeon.owner %}
                                    <span class="px-2 py-1 bg-[#D4AF37] text-black text-xs font-semibold rounded">
                                        –ü—Ä–æ–¥–∞–≤–µ—Ü
                                    </span>
                                    {% endif %}
                                </div>
                                <span class="text-sm text-gray-500">{{ comment.created_at|date:"d.m.Y H:i" }}</span>
                            </div>
                            <p class="text-gray-200 leading-relaxed">{{ comment.text }}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
            <div class="text-center py-12 text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                </svg>
                <p class="text-lg">–ü–æ–∫–∞ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤</p>
                <p class="text-sm mt-2">–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –∑–∞–¥–∞—Å—Ç –≤–æ–ø—Ä–æ—Å!</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}

