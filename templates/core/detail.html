{% extends 'base.html' %}

{% block title %}{{ pigeon.title }} - –ì–æ–ª—É–±–ë–æ–∑–æ—Ä{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<div class="mb-6 flex flex-wrap items-center justify-between">
    <div>
        <a href="{% url 'home' %}" class="text-[#D4AF37] hover:underline">–ì–ª–∞–≤–Ω–∞—è</a>
        <span class="text-gray-600 mx-2">/</span>
        <span class="text-gray-400">{{ pigeon.title }}</span>
    </div>
    
    <!-- Views Counter -->
    <div class="flex items-center text-gray-400 text-sm mt-2 md:mt-0">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
        </svg>
        {{ pigeon.views_count }} –ø—Ä–æ—Å–º–æ—Ç—Ä{{ pigeon.views_count|pluralize:",–∞,–æ–≤" }}
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Left Column - Media & Details -->
    <div class="lg:col-span-2">
        <!-- VIP Badge -->
        {% if pigeon.is_vip %}
        <div class="bg-[#D4AF37] text-black text-center py-3 font-bold text-lg rounded-t-lg">
            ‚≠ê VIP –û–ë–™–Ø–í–õ–ï–ù–ò–ï ‚≠ê
        </div>
        {% endif %}
        
        <!-- Main Image with Lightbox -->
        <div class="{% if pigeon.is_vip %}border-4 border-[#D4AF37]{% else %}border border-gray-800{% endif %} rounded-lg overflow-hidden mb-6" data-aos="zoom-in">
            <a href="{{ pigeon.image.url }}" class="lightbox">
                <img 
                    src="{{ pigeon.image.url }}" 
                    alt="{{ pigeon.title }}"
                    class="w-full h-auto cursor-zoom-in hover:opacity-90 transition"
                >
            </a>
        </div>
        
        <!-- Action Buttons (Favorite & Share) -->
        <div class="grid grid-cols-2 gap-4 mb-6">
            <!-- Favorite Button -->
            <button 
                onclick="toggleFavorite({{ pigeon.pk }}, this)"
                class="flex items-center justify-center px-4 py-3 border-2 rounded-lg font-semibold transition
                {% if is_favorited %}
                    border-red-500 text-red-500 bg-red-500/10
                {% else %}
                    border-gray-700 text-gray-300 hover:border-[#D4AF37] hover:text-[#D4AF37]
                {% endif %}"
            >
                <span class="heart-icon">
                    {% if is_favorited %}
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                    </svg>
                    {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                    {% endif %}
                </span>
                <span class="favorite-text">{% if is_favorited %}–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º{% else %}–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ{% endif %}</span>
            </button>
            
            <!-- Share Button -->
            <button 
                onclick="shareProduct('{{ pigeon.title }}', window.location.href)"
                class="flex items-center justify-center px-4 py-3 border-2 border-gray-700 text-gray-300 rounded-lg font-semibold hover:border-[#D4AF37] hover:text-[#D4AF37] transition"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                </svg>
                –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
            </button>
        </div>
        
        <!-- Pigeon Details Grid -->
        <div class="bg-[#1E1E1E] rounded-lg p-6 border border-gray-800 mb-6">
            <h2 class="text-2xl font-bold mb-4 gold-text">üìã –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="bg-[#121212] p-4 rounded-lg">
                    <p class="text-gray-500 text-sm mb-1">–ü–æ—Ä–æ–¥–∞</p>
                    <p class="text-gray-200 font-semibold text-lg">{{ pigeon.get_breed_display }}</p>
                </div>
                <div class="bg-[#121212] p-4 rounded-lg">
                    <p class="text-gray-500 text-sm mb-1">–ü–æ–ª</p>
                    <p class="text-gray-200 font-semibold text-lg">{{ pigeon.get_sex_display }}</p>
                </div>
                <div class="bg-[#121212] p-4 rounded-lg">
                    <p class="text-gray-500 text-sm mb-1">üèôÔ∏è –ì–æ—Ä–æ–¥</p>
                    <p class="text-gray-200 font-semibold text-lg">{{ pigeon.get_city_display }}</p>
                </div>
                <div class="bg-[#121212] p-4 rounded-lg">
                    <p class="text-gray-500 text-sm mb-1">–¢–∏–ø/–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</p>
                    <p class="text-gray-200 font-semibold text-lg">{{ pigeon.get_game_type_display }}</p>
                </div>
            </div>
        </div>
        
        <!-- Video Section -->
        {% if pigeon.video_url %}
        <div class="bg-[#1E1E1E] rounded-lg p-6 border border-gray-800 mb-6">
            <h2 class="text-2xl font-bold mb-4 gold-text">üé• –í–∏–¥–µ–æ</h2>
            <div class="aspect-w-16 aspect-h-9">
                <iframe 
                    src="{{ pigeon.get_youtube_embed_url }}" 
                    class="w-full h-64 md:h-96 rounded-lg"
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen
                ></iframe>
            </div>
        </div>
        {% endif %}
        
        <!-- Description -->
        <div class="bg-[#1E1E1E] rounded-lg p-6 border border-gray-800">
            <h2 class="text-2xl font-bold mb-4 gold-text">üìù –û–ø–∏—Å–∞–Ω–∏–µ</h2>
            <p class="text-gray-300 leading-relaxed whitespace-pre-line">{{ pigeon.description }}</p>
        </div>
    </div>
    
    <!-- Right Column - Price & Contact -->
    <div class="lg:col-span-1">
        <div class="bg-[#1E1E1E] rounded-lg p-6 border border-gray-800 sticky top-20">
            <!-- Price -->
            <div class="mb-6 pb-6 border-b border-gray-700">
                <p class="text-gray-500 text-sm mb-2">–¶–µ–Ω–∞</p>
                <p class="text-4xl md:text-5xl font-bold gold-text">{{ pigeon.price }}</p>
                <p class="text-gray-400 text-lg mt-1">TJS</p>
            </div>
            
            <!-- Seller Info -->
            <div class="mb-6 pb-6 border-b border-gray-700">
                <h3 class="text-lg font-semibold mb-3 text-gray-300">–ü—Ä–æ–¥–∞–≤–µ—Ü</h3>
                <a href="{% url 'seller_profile' pigeon.owner.username %}" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-[#2A2A2A] transition group">
                    <div class="w-12 h-12 bg-[#D4AF37] rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-black font-bold text-xl">{{ pigeon.owner.username|first|upper }}</span>
                    </div>
                    <div>
                        <p class="text-gray-200 font-semibold group-hover:text-[#D4AF37] transition">{{ pigeon.owner.username }}</p>
                        <p class="text-gray-500 text-sm">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ‚Üí</p>
                    </div>
                </a>
            </div>
            
            <!-- Contact Buttons -->
            <div class="space-y-3">
                <h3 class="text-lg font-semibold mb-3 text-gray-300">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                
                <!-- Phone -->
                <a href="tel:{{ pigeon.phone }}" class="flex items-center justify-center px-4 py-3 bg-[#D4AF37] text-black font-bold rounded-lg hover:bg-[#C5A028] transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                    </svg>
                    {{ pigeon.phone }}
                </a>
                
                <!-- WhatsApp -->
                {% if pigeon.whatsapp_number %}
                <a href="https://wa.me/{{ pigeon.whatsapp_number|cut:'+' }}" target="_blank" class="flex items-center justify-center px-4 py-3 bg-[#25D366] text-white font-semibold rounded-lg hover:bg-[#20BA5A] transition">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                    </svg>
                    WhatsApp
                </a>
                {% endif %}
                
                <!-- Telegram -->
                {% if pigeon.telegram_username %}
                <a href="https://t.me/{{ pigeon.telegram_username }}" target="_blank" class="flex items-center justify-center px-4 py-3 bg-[#0088cc] text-white font-semibold rounded-lg hover:bg-[#0077b3] transition">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                    </svg>
                    Telegram
                </a>
                {% endif %}
            </div>
            
            <!-- Date Published -->
            <div class="mt-6 pt-6 border-t border-gray-700">
                <p class="text-gray-500 text-sm">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</p>
                <p class="text-gray-300 font-semibold">{{ pigeon.created_at|date:"d.m.Y –≤ H:i" }}</p>
            </div>
            
            <!-- Edit/Delete for Owner -->
            {% if user == pigeon.owner %}
            <div class="mt-6 space-y-2">
                <a href="{% url 'edit_pigeon' pigeon.pk %}" class="block text-center px-4 py-2 border-2 border-[#D4AF37] text-[#D4AF37] font-semibold rounded-lg hover:bg-[#D4AF37] hover:text-black transition">
                    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                </a>
                <a href="{% url 'delete_pigeon' pigeon.pk %}" class="block text-center px-4 py-2 border-2 border-red-600 text-red-600 font-semibold rounded-lg hover:bg-red-600 hover:text-white transition">
                    –£–¥–∞–ª–∏—Ç—å
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Back Button -->
<div class="mt-8">
    <a href="{% url 'home' %}" class="inline-flex items-center text-[#D4AF37] hover:text-[#C5A028] transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É
    </a>
</div>
{% endblock %}
