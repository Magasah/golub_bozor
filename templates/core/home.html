{% extends 'base.html' %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –ó–æ–æ–ë–æ–∑–æ—Ä{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="text-center mb-8">
    <h1 class="text-5xl font-bold gold-text mb-4">ü¶Å –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –∂–∏–≤–æ—Ç–Ω—ã—Ö –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω–∞</h1>
    <p class="text-xl text-gray-400">–ö—É–ø–∏—Ç—å –∏ –ø—Ä–æ–¥–∞—Ç—å: –∫–æ—à–∫–∏, —Å–æ–±–∞–∫–∏, –≥–æ–ª—É–±–∏, –ø–æ–ø—É–≥–∞–∏, –ª–æ—à–∞–¥–∏, —Å–∫–æ—Ç –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ</p>
</div>

<!-- Filter Toggle Button -->
<div class="mb-6 flex justify-center lg:justify-start">
    <button 
        id="filterToggleBtn"
        onclick="toggleFilters()"
        class="flex items-center gap-3 px-6 py-3 bg-[#121212] border-2 border-[#D4AF37] text-[#D4AF37] font-bold rounded-xl hover:bg-[#D4AF37] hover:text-black transition-all duration-300 shadow-lg shadow-[#D4AF37]/20 hover:shadow-[#D4AF37]/50 hover:scale-105"
    >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
        </svg>
        <span id="filterBtnText">–û—Ç–∫—Ä—ã—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</span>
        <span id="filterCount" class="hidden px-2 py-1 bg-[#D4AF37] text-black text-xs rounded-full font-bold">0</span>
    </button>
</div>

<div class="flex flex-col lg:flex-row gap-6">
    <!-- Sidebar Filters (Hidden by Default) -->
    <aside 
        id="filterMenu" 
        class="hidden lg:w-80 bg-[#1E1E1E] rounded-lg p-6 border-2 border-[#D4AF37] h-fit lg:sticky lg:top-20 z-50 shadow-2xl shadow-[#D4AF37]/30 animate-slideIn"
    >
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold gold-text">üîç –§–∏–ª—å—Ç—Ä—ã</h2>
            <button 
                onclick="toggleFilters()"
                class="lg:hidden p-2 hover:bg-gray-800 rounded-lg transition"
                title="–ó–∞–∫—Ä—ã—Ç—å"
            >
                <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        
        <form 
            method="get" 
            action="{% url 'home' %}" 
            class="space-y-4"
            hx-get="{% url 'home' %}"
            hx-target="#animal-list-container"
            hx-swap="innerHTML"
            hx-trigger="change from:select, input delay:500ms from:input[type='text'], input delay:500ms from:input[type='number']"
            hx-indicator="#loading-indicator"
        >
            <!-- Use Django form fields -->
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">üîç –ü–æ–∏—Å–∫</label>
                {{ form.search }}
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">üêæ –ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                {{ form.category }}
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">üèôÔ∏è –ì–æ—Ä–æ–¥</label>
                {{ form.city }}
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">‚ö• –ü–æ–ª</label>
                {{ form.gender }}
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">üí∞ –ú–∏–Ω. —Ü–µ–Ω–∞ (TJS)</label>
                {{ form.price_min }}
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">üí∞ –ú–∞–∫—Å. —Ü–µ–Ω–∞ (TJS)</label>
                {{ form.price_max }}
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">üìã –¢–∏–ø –ø—Ä–æ–¥–∞–∂–∏</label>
                {{ form.listing_type }}
            </div>
            
            <!-- Buttons -->
            <div class="space-y-2 pt-2">
                <button 
                    type="submit" 
                    class="w-full px-4 py-3 bg-gradient-to-r from-[#D4AF37] to-[#FFD700] text-black font-bold rounded-lg hover:from-[#FFD700] hover:to-[#D4AF37] transition-all duration-300 shadow-lg shadow-[#D4AF37]/50 hover:scale-105"
                >
                    ‚úì –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                </button>
                <a 
                    href="{% url 'home' %}" 
                    class="block w-full text-center px-4 py-2 border-2 border-gray-700 text-gray-300 rounded-lg hover:border-[#D4AF37] hover:text-[#D4AF37] transition"
                >
                    ‚Üª –°–±—Ä–æ—Å–∏—Ç—å
                </a>
                <button 
                    type="button"
                    onclick="toggleFilters()"
                    class="lg:hidden w-full px-4 py-2 bg-gray-800 text-gray-300 rounded-lg hover:bg-gray-700 transition"
                >
                    ‚úï –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        </form>
    </aside>
    
    <!-- Main Content -->
    <div class="flex-1 relative z-0">
        <!-- Loading Indicator -->
        <div id="loading-indicator" class="htmx-indicator mb-6">
            <div class="flex items-center justify-center gap-3 p-4 bg-gray-900/50 rounded-lg border-2 border-[#D4AF37]/30">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-[#D4AF37]"></div>
                <span class="text-[#D4AF37] font-semibold">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
        </div>
        
        <!-- Animal List Container (will be updated by HTMX) -->
        <div id="animal-list-container">
            {% include 'core/_animal_list.html' %}
        </div>
    </div>
</div>

<!-- Filter Toggle Script -->
<script>
    function toggleFilters() {
        const filterMenu = document.getElementById('filterMenu');
        const filterBtn = document.getElementById('filterToggleBtn');
        const filterBtnText = document.getElementById('filterBtnText');
        
        if (filterMenu.classList.contains('hidden')) {
            // Open filters
            filterMenu.classList.remove('hidden');
            filterBtnText.textContent = '–ó–∞–∫—Ä—ã—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã';
            filterBtn.classList.add('bg-[#D4AF37]', 'text-black');
            filterBtn.classList.remove('hover:bg-[#D4AF37]', 'hover:text-black');
            
            // Add smooth animation
            setTimeout(() => {
                filterMenu.style.opacity = '1';
                filterMenu.style.transform = 'translateY(0)';
            }, 10);
        } else {
            // Close filters
            filterMenu.style.opacity = '0';
            filterMenu.style.transform = 'translateY(-20px)';
            
            setTimeout(() => {
                filterMenu.classList.add('hidden');
                filterBtnText.textContent = '–û—Ç–∫—Ä—ã—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã';
                filterBtn.classList.remove('bg-[#D4AF37]', 'text-black');
                filterBtn.classList.add('hover:bg-[#D4AF37]', 'hover:text-black');
            }, 300);
        }
    }
    
    // Count active filters on page load
    function countActiveFilters() {
        const urlParams = new URLSearchParams(window.location.search);
        let count = 0;
        const filterParams = ['search', 'breed', 'sex', 'game_type', 'city', 'max_price'];
        
        filterParams.forEach(param => {
            if (urlParams.get(param)) {
                count++;
            }
        });
        
        const filterCount = document.getElementById('filterCount');
        if (count > 0) {
            filterCount.textContent = count;
            filterCount.classList.remove('hidden');
        }
        
        return count;
    }
    
    // Initialize filter menu style
    document.addEventListener('DOMContentLoaded', function() {
        const filterMenu = document.getElementById('filterMenu');
        filterMenu.style.opacity = '0';
        filterMenu.style.transform = 'translateY(-20px)';
        filterMenu.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        
        // Show filter count
        countActiveFilters();
        
        // Auto-open if filters are active
        if (countActiveFilters() > 0) {
            toggleFilters();
        }
    });
    
    // Close filters on mobile when clicking outside
    document.addEventListener('click', function(event) {
        const filterMenu = document.getElementById('filterMenu');
        const filterBtn = document.getElementById('filterToggleBtn');
        
        if (window.innerWidth < 1024 && // Only on mobile/tablet
            !filterMenu.contains(event.target) && 
            !filterBtn.contains(event.target) &&
            !filterMenu.classList.contains('hidden')) {
            toggleFilters();
        }
    });
</script>

<style>
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .animate-slideIn {
        animation: slideIn 0.3s ease-out;
    }
    
    /* Mobile overlay */
    @media (max-width: 1023px) {
        #filterMenu:not(.hidden) {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) !important;
            max-height: 90vh;
            overflow-y: auto;
            width: 90%;
            max-width: 500px;
            z-index: 1000;
        }
        
        #filterMenu:not(.hidden)::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: -1;
        }
    }
</style>
{% endblock %}


