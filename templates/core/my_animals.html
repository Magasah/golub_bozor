{% extends 'base.html' %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - –ó–æ–æ–ë–æ–∑–æ—Ä{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<div class="mb-8">
    <h1 class="text-4xl font-bold gold-text mb-2">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
    <p class="text-gray-400">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –∞—É–∫—Ü–∏–æ–Ω—ã</p>
</div>

<!-- Tabs Navigation -->
<div class="mb-6">
    <div class="border-b border-gray-700">
        <div class="flex gap-4" role="tablist">
            <button 
                class="tab-button px-6 py-3 font-bold border-b-4 transition-all duration-300 active"
                data-tab="listings"
                onclick="switchTab('listings')"
            >
                <span class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                    </svg>
                    –ú–æ–∏ –ñ–∏–≤–æ—Ç–Ω—ã–µ
                    <span class="bg-[#D4AF37] text-black text-xs px-2 py-1 rounded-full">{{ listings_count }}</span>
                </span>
            </button>
            <button 
                class="tab-button px-6 py-3 font-bold border-b-4 transition-all duration-300"
                data-tab="bids"
                onclick="switchTab('bids')"
            >
                <span class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
                    </svg>
                    –ú–æ–∏ –°—Ç–∞–≤–∫–∏
                    <span class="bg-[#D4AF37] text-black text-xs px-2 py-1 rounded-full">{{ bids_count }}</span>
                </span>
            </button>
        </div>
    </div>
</div>

<!-- Tab Content -->
<div class="tab-content-container">
    <!-- ==================== TAB 1: MY LISTINGS ==================== -->
    <div id="tab-listings" class="tab-content active">
        <div class="mb-6 flex justify-between items-center">
            <h2 class="text-2xl font-bold text-gray-200">–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h2>
            <a href="{% url 'add_animal' %}" class="px-6 py-3 bg-gradient-to-r from-[#D4AF37] to-[#F4BF47] text-black font-bold rounded-lg hover:from-[#C5A028] hover:to-[#E5B038] transition transform hover:scale-105 shadow-lg flex items-center gap-2">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                </svg>
                –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ
            </a>
        </div>

        {% if my_listings %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for animal in my_listings %}
            <div class="bg-[#1E1E1E] rounded-lg overflow-hidden hover:transform hover:scale-105 transition-all duration-300 {% if animal.is_vip %}border-4 border-[#D4AF37] shadow-xl{% else %}border border-gray-800{% endif %}">
                <!-- VIP Badge -->
                {% if animal.is_vip %}
                <div class="bg-gradient-to-r from-[#D4AF37] to-[#F4BF47] text-black text-center py-2 font-bold">
                    ‚≠ê VIP –†–ê–ó–ú–ï–©–ï–ù–ò–ï ‚≠ê
                </div>
                {% endif %}
                
                <!-- Image with Status Badge -->
                <div class="relative">
                    <a href="{% url 'animal_detail' animal.pk %}">
                        <img 
                            src="{{ animal.main_photo.url }}" 
                            alt="{{ animal.title }}"
                            class="w-full h-64 object-cover"
                        >
                    </a>
                    
                    <!-- Approval Status -->
                    <div class="absolute top-2 right-2">
                        {% if animal.is_approved %}
                        <span class="bg-green-500 text-white px-3 py-1 rounded-full text-xs font-bold flex items-center shadow-lg">
                            <svg class="h-4 w-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            –û–¥–æ–±—Ä–µ–Ω–æ
                        </span>
                        {% else %}
                        <span class="bg-yellow-500 text-black px-3 py-1 rounded-full text-xs font-bold flex items-center shadow-lg animate-pulse">
                            <svg class="h-4 w-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                            </svg>
                            –ú–æ–¥–µ—Ä–∞—Ü–∏—è
                        </span>
                        {% endif %}
                    </div>
                    
                    <!-- Type Badge -->
                    <div class="absolute top-2 left-2">
                        {% if animal.listing_type == 'auction' %}
                        <span class="bg-[#D4AF37] text-black px-3 py-1 rounded-full text-xs font-bold flex items-center shadow-lg">
                            üî® –ê—É–∫—Ü–∏–æ–Ω
                        </span>
                        {% else %}
                        <span class="bg-gray-800 text-white px-3 py-1 rounded-full text-xs font-bold">
                            üí∞ –ü—Ä–æ–¥–∞–∂–∞
                        </span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="p-5">
                    <a href="{% url 'animal_detail' animal.pk %}">
                        <h3 class="text-xl font-bold mb-2 line-clamp-1 hover:text-[#D4AF37] transition">
                            {{ animal.title }}
                        </h3>
                    </a>
                    
                    <p class="text-sm text-gray-500 mb-3">{{ animal.get_breed_display }} ‚Ä¢ {{ animal.get_sex_display }}</p>
                    
                    <!-- Price/Bid Info -->
                    {% if animal.listing_type == 'auction' %}
                    <div class="mb-4">
                        <p class="text-sm text-gray-400">–¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞:</p>
                        <p class="text-2xl font-black text-[#D4AF37]">
                            {{ animal.current_price|default:animal.start_price }} <span class="text-sm">TJS</span>
                        </p>
                        <p class="text-xs text-gray-500 mt-1">–°—Ç–∞–≤–æ–∫: {{ animal.get_bid_count }}</p>
                    </div>
                    {% else %}
                    <p class="text-3xl font-bold gold-text mb-4">
                        {{ animal.price }} <span class="text-sm">TJS</span>
                    </p>
                    {% endif %}
                    
                    <div class="text-sm text-gray-500 mb-4 flex items-center">
                        <svg class="h-4 w-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                        </svg>
                        {{ animal.created_at|date:"d.m.Y H:i" }}
                    </div>
                    
                    <!-- Actions -->
                    <div class="grid grid-cols-2 gap-2">
                        <a href="{% url 'edit_animal' animal.pk %}" class="text-center px-4 py-2 border-2 border-[#D4AF37] text-[#D4AF37] font-bold rounded-lg hover:bg-[#D4AF37] hover:text-black transition">
                            –ò–∑–º–µ–Ω–∏—Ç—å
                        </a>
                        <a href="{% url 'delete_animal' animal.pk %}" class="text-center px-4 py-2 border-2 border-red-600 text-red-600 font-bold rounded-lg hover:bg-red-600 hover:text-white transition">
                            –£–¥–∞–ª–∏—Ç—å
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-20 bg-[#1E1E1E] rounded-xl border border-gray-800">
            <div class="text-7xl mb-4">üïäÔ∏è</div>
            <h2 class="text-3xl font-bold text-gray-300 mb-3">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h2>
            <p class="text-gray-500 mb-8 text-lg">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–µ –ø–µ—Ä–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø—Ä–æ–¥–∞–≤–∞—Ç—å</p>
            <a href="{% url 'add_animal' %}" class="inline-block px-8 py-4 bg-[#D4AF37] text-black font-bold text-lg rounded-lg hover:bg-[#C5A028] transition transform hover:scale-105 shadow-xl">
                –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
            </a>
        </div>
        {% endif %}
    </div>

    <!-- ==================== TAB 2: MY BIDS ==================== -->
    <div id="tab-bids" class="tab-content hidden">
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-gray-200">–ú–æ–∏ —Å—Ç–∞–≤–∫–∏ –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω–∞—Ö</h2>
            <p class="text-gray-400 mt-1">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ —Å—Ç–∞–≤–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>

        {% if my_bids_data %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for item in my_bids_data %}
            <div class="bg-[#1E1E1E] rounded-lg overflow-hidden border-2 
                {% if item.is_winner %}border-[#D4AF37]
                {% elif item.is_winning %}border-green-500
                {% else %}border-red-500
                {% endif %} 
                hover:transform hover:scale-105 transition-all duration-300 shadow-xl">
                
                <!-- Status Banner -->
                <div class="
                    {% if item.is_winner %}bg-gradient-to-r from-[#D4AF37] to-[#F4BF47] text-black
                    {% elif item.is_winning %}bg-green-500 text-white
                    {% else %}bg-red-500 text-white
                    {% endif %}
                    text-center py-2 font-black text-sm flex items-center justify-center gap-2">
                    {% if item.is_winner %}
                        üèÜ –ü–û–ë–ï–î–ê! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –∞—É–∫—Ü–∏–æ–Ω!
                    {% elif item.is_winning %}
                        üü¢ –í–´ –õ–ò–î–ò–†–£–ï–¢–ï
                    {% else %}
                        üî¥ –í–ê–° –ü–ï–†–ï–ë–ò–õ–ò!
                    {% endif %}
                </div>
                
                <!-- Image -->
                <div class="relative">
                    <a href="{% url 'animal_detail' item.animal.pk %}">
                        <img 
                            src="{{ item.animal.main_photo.url }}" 
                            alt="{{ item.animal.title }}"
                            class="w-full h-64 object-cover"
                        >
                    </a>
                    
                    <!-- Auction Status -->
                    <div class="absolute top-2 right-2">
                        {% if item.auction_ended %}
                        <span class="bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg">
                            –ó–∞–≤–µ—Ä—à—ë–Ω
                        </span>
                        {% else %}
                        <span class="bg-green-500 text-white px-3 py-1 rounded-full text-xs font-bold flex items-center shadow-lg animate-pulse">
                            <span class="w-2 h-2 bg-white rounded-full mr-2 animate-ping"></span>
                            –ò–¥—ë—Ç
                        </span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="p-5">
                    <a href="{% url 'animal_detail' item.animal.pk %}">
                        <h3 class="text-xl font-bold mb-3 line-clamp-1 hover:text-[#D4AF37] transition">
                            {{ item.animal.title }}
                        </h3>
                    </a>
                    
                    <!-- Bid Comparison -->
                    <div class="space-y-3 mb-4">
                        <div class="bg-[#121212] p-3 rounded-lg">
                            <p class="text-xs text-gray-500 mb-1">–¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞</p>
                            <p class="text-2xl font-black text-[#D4AF37]">{{ item.current_price }} TJS</p>
                        </div>
                        <div class="bg-[#121212] p-3 rounded-lg">
                            <p class="text-xs text-gray-500 mb-1">–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞</p>
                            <p class="text-xl font-bold 
                                {% if item.is_winning %}text-green-400
                                {% else %}text-gray-400
                                {% endif %}">
                                {{ item.my_bid }} TJS
                            </p>
                        </div>
                    </div>
                    
                    <!-- Action Button -->
                    {% if not item.auction_ended %}
                    <a href="{% url 'animal_detail' item.animal.pk %}#bid-form-container" 
                       class="block text-center px-4 py-3 
                       {% if item.is_winning %}
                           bg-gray-700 text-gray-300 border-2 border-gray-600
                       {% else %}
                           bg-gradient-to-r from-red-600 to-red-700 text-white border-2 border-red-500 animate-pulse
                       {% endif %}
                       font-bold rounded-lg hover:scale-105 transition transform shadow-lg">
                        {% if item.is_winning %}
                            üëÄ –°–ª–µ–¥–∏—Ç—å –∑–∞ –∞—É–∫—Ü–∏–æ–Ω–æ–º
                        {% else %}
                            üî• –ü–µ—Ä–µ–±–∏—Ç—å —Å—Ç–∞–≤–∫—É!
                        {% endif %}
                    </a>
                    {% else %}
                        {% if item.is_winner %}
                        <button class="w-full px-4 py-3 bg-gradient-to-r from-[#D4AF37] to-[#F4BF47] text-black font-black rounded-lg shadow-2xl">
                            üéâ –ó–ê–ë–†–ê–¢–¨ –ü–†–ò–ó
                        </button>
                        {% else %}
                        <a href="{% url 'animal_detail' item.animal.pk %}" 
                           class="block text-center px-4 py-3 bg-gray-700 text-gray-400 font-bold rounded-lg border-2 border-gray-600">
                            –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                        </a>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-20 bg-[#1E1E1E] rounded-xl border border-gray-800">
            <div class="text-7xl mb-4">üî®</div>
            <h2 class="text-3xl font-bold text-gray-300 mb-3">–í—ã –µ—â—ë –Ω–µ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ –∞—É–∫—Ü–∏–æ–Ω–∞—Ö</h2>
            <p class="text-gray-500 mb-8 text-lg">–ù–∞–π–¥–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –∞—É–∫—Ü–∏–æ–Ω –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Å—Ç–∞–≤–∫—É</p>
            <a href="{% url 'home' %}" class="inline-block px-8 py-4 bg-[#D4AF37] text-black font-bold text-lg rounded-lg hover:bg-[#C5A028] transition transform hover:scale-105 shadow-xl">
                –ù–∞–π—Ç–∏ –∞—É–∫—Ü–∏–æ–Ω—ã
            </a>
        </div>
        {% endif %}
    </div>
</div>

<!-- Tab Switching JavaScript -->
<style>
.tab-button {
    color: #9CA3AF;
    border-bottom-color: transparent;
}
.tab-button.active {
    color: #D4AF37;
    border-bottom-color: #D4AF37;
}
.tab-content {
    animation: fadeIn 0.3s ease-in;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>

<script>
function switchTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
        tab.classList.remove('active');
    });
    
    // Remove active class from all buttons
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById('tab-' + tabName).classList.remove('hidden');
    document.getElementById('tab-' + tabName).classList.add('active');
    
    // Mark button as active
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
    
    // Save to localStorage
    localStorage.setItem('activeTab', tabName);
}

// Restore last active tab on page load
document.addEventListener('DOMContentLoaded', function() {
    const lastTab = localStorage.getItem('activeTab') || 'listings';
    switchTab(lastTab);
});
</script>
{% endblock %}

