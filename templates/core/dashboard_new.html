{% extends 'base.html' %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - –ó–æ–æ–ë–æ–∑–æ—Ä{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8 gap-4">
        <div>
            <h1 class="text-4xl font-bold text-[#D4AF37] mb-2">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
            <p class="text-gray-400">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ request.user.username }}!</p>
        </div>
        <a href="{% url 'add_animal' %}" 
           class="px-6 py-3 bg-gradient-to-r from-[#D4AF37] to-[#FFD700] text-black font-bold rounded-lg hover:from-[#FFD700] hover:to-[#D4AF37] transition-all duration-300 shadow-lg flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
            </svg>
            –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        </a>
    </div>

    <!-- Tabs Navigation -->
    <div class="border-b-2 border-gray-800 mb-8">
        <nav class="flex space-x-2 overflow-x-auto pb-0">
            <a href="?tab=listings" 
               class="px-6 py-3 font-semibold border-b-2 transition whitespace-nowrap
                      {% if active_tab == 'listings' %}
                      border-[#D4AF37] text-[#D4AF37]
                      {% else %}
                      border-transparent text-gray-400 hover:text-white
                      {% endif %}">
                <span class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                    </svg>
                    –ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
                </span>
            </a>
            
            <a href="?tab=bids" 
               class="px-6 py-3 font-semibold border-b-2 transition whitespace-nowrap
                      {% if active_tab == 'bids' %}
                      border-[#D4AF37] text-[#D4AF37]
                      {% else %}
                      border-transparent text-gray-400 hover:text-white
                      {% endif %}">
                <span class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"/>
                    </svg>
                    –ú–æ–∏ —Å—Ç–∞–≤–∫–∏
                </span>
            </a>
            
            <a href="?tab=favorites" 
               class="px-6 py-3 font-semibold border-b-2 transition whitespace-nowrap
                      {% if active_tab == 'favorites' %}
                      border-[#D4AF37] text-[#D4AF37]
                      {% else %}
                      border-transparent text-gray-400 hover:text-white
                      {% endif %}">
                <span class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
                    </svg>
                    –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
                </span>
            </a>
        </nav>
    </div>

    <!-- TAB 1: MY LISTINGS -->
    {% if active_tab == 'listings' %}
    <div class="space-y-6">
        <!-- Statistics -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-[#1E1E1E] rounded-lg p-4 border border-gray-800">
                <div class="text-2xl mb-1">üìä</div>
                <div class="text-2xl font-bold text-white">{{ total_count }}</div>
                <div class="text-gray-400 text-xs">–í—Å–µ–≥–æ</div>
            </div>
            
            <div class="bg-[#1E1E1E] rounded-lg p-4 border border-gray-800">
                <div class="text-2xl mb-1">‚úÖ</div>
                <div class="text-2xl font-bold text-green-400">{{ active_count }}</div>
                <div class="text-gray-400 text-xs">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
            </div>
            
            <div class="bg-[#1E1E1E] rounded-lg p-4 border border-gray-800">
                <div class="text-2xl mb-1">‚è≥</div>
                <div class="text-2xl font-bold text-yellow-400">{{ pending_count }}</div>
                <div class="text-gray-400 text-xs">–ú–æ–¥–µ—Ä–∞—Ü–∏—è</div>
            </div>
            
            <div class="bg-[#1E1E1E] rounded-lg p-4 border border-gray-800">
                <div class="text-2xl mb-1">üí∞</div>
                <div class="text-2xl font-bold text-blue-400">{{ sold_count }}</div>
                <div class="text-gray-400 text-xs">–ü—Ä–æ–¥–∞–Ω–æ</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="flex flex-wrap gap-2">
            <a href="?tab=listings&status=all" 
               class="px-4 py-2 rounded-lg font-medium transition
                      {% if status_filter == 'all' %}
                      bg-[#D4AF37] text-black
                      {% else %}
                      bg-[#1E1E1E] text-gray-400 hover:text-[#D4AF37]
                      {% endif %}">
                –í—Å–µ
            </a>
            <a href="?tab=listings&status=active" 
               class="px-4 py-2 rounded-lg font-medium transition
                      {% if status_filter == 'active' %}
                      bg-[#D4AF37] text-black
                      {% else %}
                      bg-[#1E1E1E] text-gray-400 hover:text-[#D4AF37]
                      {% endif %}">
                –ê–∫—Ç–∏–≤–Ω—ã–µ
            </a>
            <a href="?tab=listings&status=pending" 
               class="px-4 py-2 rounded-lg font-medium transition
                      {% if status_filter == 'pending' %}
                      bg-[#D4AF37] text-black
                      {% else %}
                      bg-[#1E1E1E] text-gray-400 hover:text-[#D4AF37]
                      {% endif %}">
                –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
            </a>
            <a href="?tab=listings&status=sold" 
               class="px-4 py-2 rounded-lg font-medium transition
                      {% if status_filter == 'sold' %}
                      bg-[#D4AF37] text-black
                      {% else %}
                      bg-[#1E1E1E] text-gray-400 hover:text-[#D4AF37]
                      {% endif %}">
                –ü—Ä–æ–¥–∞–Ω–Ω—ã–µ
            </a>
        </div>

        <!-- Listings Grid -->
        {% if animals %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for animal in animals %}
            <div class="bg-[#1E1E1E] rounded-lg overflow-hidden border-2
                        {% if animal.is_vip %}border-[#D4AF37]{% else %}border-gray-800{% endif %}
                        hover:border-[#D4AF37] transition">
                <!-- Image -->
                <div class="relative h-40">
                    {% if animal.main_photo %}
                    <img src="{{ animal.main_photo.url }}" alt="{{ animal.title }}" 
                         class="w-full h-full object-cover">
                    {% else %}
                    <div class="w-full h-full bg-gray-800 flex items-center justify-center">
                        <span class="text-4xl">üì∑</span>
                    </div>
                    {% endif %}
                    
                    <!-- VIP Badge -->
                    {% if animal.is_vip %}
                    <div class="absolute top-2 left-2 bg-gradient-to-r from-[#D4AF37] to-[#FFD700] text-black px-2 py-1 rounded text-xs font-bold">
                        ‚≠ê VIP
                    </div>
                    {% endif %}
                    
                    <!-- Status Badge -->
                    <div class="absolute top-2 right-2">
                        {% if not animal.is_approved %}
                        <span class="bg-yellow-600 text-white px-2 py-1 rounded text-xs font-bold">‚è≥ –ú–æ–¥–µ—Ä–∞—Ü–∏—è</span>
                        {% elif animal.status == 'sold' %}
                        <span class="bg-blue-600 text-white px-2 py-1 rounded text-xs font-bold">üí∞ –ü—Ä–æ–¥–∞–Ω–æ</span>
                        {% elif animal.status == 'active' %}
                        <span class="bg-green-600 text-white px-2 py-1 rounded text-xs font-bold">‚úÖ –ê–∫—Ç–∏–≤–Ω–æ</span>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Content -->
                <div class="p-4">
                    <h3 class="text-lg font-bold text-[#D4AF37] mb-2 truncate">{{ animal.title }}</h3>
                    
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-xl font-bold text-white">{{ animal.price }} TJS</span>
                        <span class="text-xs text-gray-500">{{ animal.views }} üëÅÔ∏è</span>
                    </div>
                    
                    <!-- Actions -->
                    <div class="flex gap-2">
                        <a href="{% url 'animal_detail' animal.pk %}" 
                           class="flex-1 px-3 py-2 bg-[#2A2A2A] text-center text-sm font-medium text-gray-300 rounded hover:bg-[#3A3A3A] transition">
                            üëÅÔ∏è –°–º–æ—Ç—Ä–µ—Ç—å
                        </a>
                        <a href="{% url 'edit_animal' animal.pk %}" 
                           class="px-3 py-2 bg-[#D4AF37] text-black text-sm font-bold rounded hover:bg-[#C5A028] transition">
                            ‚úèÔ∏è
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Pagination -->
        {% if animals.has_other_pages %}
        <div class="flex justify-center mt-8">
            <nav class="flex gap-2">
                {% if animals.has_previous %}
                <a href="?tab=listings&status={{ status_filter }}&page={{ animals.previous_page_number }}" 
                   class="px-4 py-2 bg-[#1E1E1E] text-[#D4AF37] rounded hover:bg-[#2A2A2A]">
                    ‚Üê –ù–∞–∑–∞–¥
                </a>
                {% endif %}
                
                <span class="px-4 py-2 bg-[#D4AF37] text-black rounded font-bold">
                    {{ animals.number }} / {{ animals.paginator.num_pages }}
                </span>
                
                {% if animals.has_next %}
                <a href="?tab=listings&status={{ status_filter }}&page={{ animals.next_page_number }}" 
                   class="px-4 py-2 bg-[#1E1E1E] text-[#D4AF37] rounded hover:bg-[#2A2A2A]">
                    –í–ø–µ—Ä–µ–¥ ‚Üí
                </a>
                {% endif %}
            </nav>
        </div>
        {% endif %}
        
        {% else %}
        <div class="text-center py-16">
            <div class="text-6xl mb-4">üì≠</div>
            <p class="text-xl text-gray-400 mb-4">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>
            <a href="{% url 'add_animal' %}" 
               class="inline-block px-6 py-3 bg-[#D4AF37] text-black font-bold rounded-lg hover:bg-[#C5A028]">
                –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
            </a>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- TAB 2: MY BIDS -->
    {% if active_tab == 'bids' %}
    <div class="space-y-6">
        <!-- Statistics -->
        <div class="grid grid-cols-3 gap-4">
            <div class="bg-[#1E1E1E] rounded-lg p-4 border border-gray-800">
                <div class="text-2xl mb-1">üî®</div>
                <div class="text-2xl font-bold text-white">{{ total_bids }}</div>
                <div class="text-gray-400 text-xs">–í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫</div>
            </div>
            
            <div class="bg-[#1E1E1E] rounded-lg p-4 border border-gray-800">
                <div class="text-2xl mb-1">‚è∞</div>
                <div class="text-2xl font-bold text-yellow-400">{{ active_bids_count }}</div>
                <div class="text-gray-400 text-xs">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
            </div>
            
            <div class="bg-[#1E1E1E] rounded-lg p-4 border border-gray-800">
                <div class="text-2xl mb-1">üèÜ</div>
                <div class="text-2xl font-bold text-green-400">{{ won_count }}</div>
                <div class="text-gray-400 text-xs">–í—ã–∏–≥—Ä–∞–Ω–æ</div>
            </div>
        </div>

        {% if my_bids %}
        <!-- Active Bids -->
        {% if active_bids %}
        <div>
            <h3 class="text-xl font-bold text-[#D4AF37] mb-4">‚è∞ –ê–∫—Ç–∏–≤–Ω—ã–µ –∞—É–∫—Ü–∏–æ–Ω—ã</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% for bid in active_bids %}
                <div class="bg-[#1E1E1E] rounded-lg p-4 border border-gray-800 hover:border-[#D4AF37] transition">
                    <div class="flex gap-4">
                        <img src="{{ bid.animal.main_photo.url }}" alt="{{ bid.animal.title }}" 
                             class="w-24 h-24 object-cover rounded">
                        <div class="flex-1">
                            <h4 class="font-bold text-white mb-1">{{ bid.animal.title }}</h4>
                            <p class="text-sm text-gray-400 mb-2">–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞: <span class="text-[#D4AF37] font-bold">{{ bid.amount }} TJS</span></p>
                            <p class="text-xs text-gray-500">–û–∫–æ–Ω—á–∞–Ω–∏–µ: {{ bid.animal.auction_end_date|date:"d.m.Y H:i" }}</p>
                            <a href="{% url 'animal_detail' bid.animal.pk %}" 
                               class="inline-block mt-2 text-xs text-[#D4AF37] hover:text-white">
                                –ü–µ—Ä–µ–π—Ç–∏ –∫ –∞—É–∫—Ü–∏–æ–Ω—É ‚Üí
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Won Bids -->
        {% if won_bids %}
        <div>
            <h3 class="text-xl font-bold text-green-400 mb-4">üèÜ –í—ã–∏–≥—Ä–∞–Ω–Ω—ã–µ –∞—É–∫—Ü–∏–æ–Ω—ã</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% for bid in won_bids %}
                <div class="bg-[#1E1E1E] rounded-lg p-4 border-2 border-green-500 hover:border-green-400 transition">
                    <div class="flex gap-4">
                        <img src="{{ bid.animal.main_photo.url }}" alt="{{ bid.animal.title }}" 
                             class="w-24 h-24 object-cover rounded">
                        <div class="flex-1">
                            <div class="bg-green-600 text-white px-2 py-1 rounded text-xs font-bold inline-block mb-2">
                                üèÜ –ü–æ–±–µ–¥–∞!
                            </div>
                            <h4 class="font-bold text-white mb-1">{{ bid.animal.title }}</h4>
                            <p class="text-sm text-gray-400 mb-2">–¶–µ–Ω–∞: <span class="text-green-400 font-bold">{{ bid.amount }} TJS</span></p>
                            <a href="{% url 'animal_detail' bid.animal.pk %}" 
                               class="inline-block mt-2 text-xs text-[#D4AF37] hover:text-white">
                                –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º ‚Üí
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% else %}
        <div class="text-center py-16">
            <div class="text-6xl mb-4">üî®</div>
            <p class="text-xl text-gray-400 mb-4">–í—ã –µ—â–µ –Ω–µ –¥–µ–ª–∞–ª–∏ —Å—Ç–∞–≤–æ–∫</p>
            <a href="{% url 'home' %}?listing_type=auction" 
               class="inline-block px-6 py-3 bg-[#D4AF37] text-black font-bold rounded-lg hover:bg-[#C5A028]">
                –ù–∞–π—Ç–∏ –∞—É–∫—Ü–∏–æ–Ω—ã
            </a>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- TAB 3: FAVORITES -->
    {% if active_tab == 'favorites' %}
    <div class="space-y-6">
        <div class="flex items-center justify-between">
            <h2 class="text-2xl font-bold text-[#D4AF37]">‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ ({{ favorites_count }})</h2>
        </div>

        {% if favorites %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for animal in favorites %}
            <div class="bg-[#1E1E1E] rounded-lg overflow-hidden border-2 border-gray-800 hover:border-[#D4AF37] transition">
                <!-- Image -->
                <div class="relative h-40">
                    <img src="{{ animal.main_photo.url }}" alt="{{ animal.title }}" 
                         class="w-full h-full object-cover">
                    
                    {% if animal.is_vip %}
                    <div class="absolute top-2 left-2 bg-gradient-to-r from-[#D4AF37] to-[#FFD700] text-black px-2 py-1 rounded text-xs font-bold">
                        ‚≠ê VIP
                    </div>
                    {% endif %}
                </div>
                
                <!-- Content -->
                <div class="p-4">
                    <h3 class="text-lg font-bold text-[#D4AF37] mb-2 truncate">{{ animal.title }}</h3>
                    
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-xl font-bold text-white">{{ animal.price }} TJS</span>
                        <span class="text-xs text-gray-400">{{ animal.city }}</span>
                    </div>
                    
                    <!-- Actions -->
                    <div class="flex gap-2">
                        <a href="{% url 'animal_detail' animal.pk %}" 
                           class="flex-1 px-3 py-2 bg-[#2A2A2A] text-center text-sm font-medium text-gray-300 rounded hover:bg-[#3A3A3A] transition">
                            üëÅÔ∏è –°–º–æ—Ç—Ä–µ—Ç—å
                        </a>
                        <form method="post" action="{% url 'remove_from_favorites' animal.pk %}" class="inline">
                            {% csrf_token %}
                            <button type="submit" 
                                    class="px-3 py-2 bg-red-600 text-white text-sm font-bold rounded hover:bg-red-700 transition">
                                üóëÔ∏è
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Pagination -->
        {% if favorites.has_other_pages %}
        <div class="flex justify-center mt-8">
            <nav class="flex gap-2">
                {% if favorites.has_previous %}
                <a href="?tab=favorites&page={{ favorites.previous_page_number }}" 
                   class="px-4 py-2 bg-[#1E1E1E] text-[#D4AF37] rounded hover:bg-[#2A2A2A]">
                    ‚Üê –ù–∞–∑–∞–¥
                </a>
                {% endif %}
                
                <span class="px-4 py-2 bg-[#D4AF37] text-black rounded font-bold">
                    {{ favorites.number }} / {{ favorites.paginator.num_pages }}
                </span>
                
                {% if favorites.has_next %}
                <a href="?tab=favorites&page={{ favorites.next_page_number }}" 
                   class="px-4 py-2 bg-[#1E1E1E] text-[#D4AF37] rounded hover:bg-[#2A2A2A]">
                    –í–ø–µ—Ä–µ–¥ ‚Üí
                </a>
                {% endif %}
            </nav>
        </div>
        {% endif %}
        
        {% else %}
        <div class="text-center py-16">
            <div class="text-6xl mb-4">üíî</div>
            <p class="text-xl text-gray-400 mb-4">–í–∞—à–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –ø—É—Å—Ç–æ</p>
            <a href="{% url 'home' %}" 
               class="inline-block px-6 py-3 bg-[#D4AF37] text-black font-bold rounded-lg hover:bg-[#C5A028]">
                –ù–∞–π—Ç–∏ –∂–∏–≤–æ—Ç–Ω—ã—Ö
            </a>
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
