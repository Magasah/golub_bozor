{% extends 'base.html' %}
{% load static %}

{% block title %}{% if animal %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å{% else %}–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ{% endif %} - –ó–æ–æ–ë–æ–∑–æ—Ä{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <h1 class="text-3xl md:text-4xl font-bold gold-text mb-8">
        {% if animal %}
        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        {% else %}
        –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        {% endif %}
    </h1>
    
    <div class="bg-[#1E1E1E] rounded-lg p-6 md:p-8 border border-gray-800">
        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            <!-- Form Errors Display -->
            {% if form.errors %}
            <div class="border-2 border-red-600 bg-red-900/30 rounded-lg p-5 mb-6">
                <div class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500 mr-3 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div class="flex-1">
                        <p class="text-lg font-bold text-red-400 mb-2">‚ùå –û—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–µ:</p>
                        <ul class="list-disc list-inside space-y-1 text-red-300">
                            {% for field in form %}
                                {% if field.errors %}
                                    {% for error in field.errors %}
                                    <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                            {% if form.non_field_errors %}
                                {% for error in form.non_field_errors %}
                                <li>{{ error }}</li>
                                {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Listing Type (Radio Buttons) -->
            <div class="border-2 border-[#D4AF37] rounded-lg p-5 bg-[#121212]">
                <label class="block text-lg font-bold text-[#D4AF37] mb-4">
                    üìã –¢–∏–ø —Ä–∞–∑–º–µ—â–µ–Ω–∏—è *
                </label>
                <div class="space-y-3">
                    {% for choice_value, choice_label in form.listing_type.field.choices %}
                    <label class="flex items-center p-4 bg-[#1E1E1E] rounded-lg border-2 border-gray-700 hover:border-[#D4AF37] cursor-pointer transition group">
                        <input type="radio" name="listing_type" value="{{ choice_value }}" 
                               class="w-5 h-5 text-[#D4AF37] bg-[#121212] border-gray-600 focus:ring-[#D4AF37] focus:ring-2"
                               {% if form.listing_type.value == choice_value or choice_value == 'fixed' and not form.listing_type.value %}checked{% endif %}
                               onchange="toggleAuctionFields()">
                        <span class="ml-3 text-base font-medium text-gray-200 group-hover:text-[#D4AF37]">
                            {{ choice_label }}
                        </span>
                    </label>
                    {% endfor %}
                </div>
                {% if form.listing_type.errors %}
                    <p class="text-red-500 text-sm mt-2">{{ form.listing_type.errors.0 }}</p>
                {% endif %}
            </div>
            
            <!-- Category Selection with HTMX -->
            <div>
                <label for="{{ form.category.id_for_label }}" class="block text-lg font-semibold text-[#D4AF37] mb-2">
                    üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∂–∏–≤–æ—Ç–Ω–æ–≥–æ *
                </label>
                <select 
                    name="category" 
                    id="id_category"
                    class="w-full px-4 py-3 rounded-lg border-2 border-gray-700 bg-[#121212] text-white focus:ring-2 focus:ring-[#D4AF37] focus:border-[#D4AF37]"
                    hx-get="{% url 'get_animal_fields' %}"
                    hx-target="#specific-fields-container"
                    hx-trigger="change"
                    hx-include="[name='category']"
                    required
                >
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                    {% for value, label in form.category.field.choices %}
                        <option value="{{ value }}">{{ label }}</option>
                    {% endfor %}
                </select>
                {% if form.category.errors %}
                    <p class="text-red-500 text-sm mt-2">{{ form.category.errors.0 }}</p>
                {% endif %}
            </div>
            
            <!-- –ó–ê–î–ê–ß–ê 3: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π -->
            <div id="specific-fields-container" class="border-2 border-[#D4AF37]/30 rounded-lg p-5 bg-[#1E1E1E]">
                <p class="text-gray-500 text-center py-8">
                    ‚¨ÜÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–æ–ª—è
                </p>
            </div>
            
            <!-- Auction Fee Warning (Hidden by default) -->
            <div id="auctionWarning" class="hidden border-2 border-red-600 bg-red-900/20 rounded-lg p-5">
                <div class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500 mr-3 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <div>
                        <p class="text-lg font-bold text-[#D4AF37] mb-1">‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</p>
                        <p class="text-base text-red-400 font-semibold">
                            –°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞: <span class="text-2xl text-[#D4AF37]">3 —Å–æ–º–æ–Ω–∏</span>
                        </p>
                        <p class="text-sm text-gray-400 mt-2">
                            –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≤–∞—à –∞—É–∫—Ü–∏–æ–Ω –±—É–¥–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Payment Instructions Box (Hidden by default) -->
            <div id="paymentBox" class="hidden border-2 border-[#D4AF37] bg-gradient-to-br from-[#1E1E1E] to-[#121212] rounded-lg p-6">
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-bold text-[#D4AF37] mb-3">üí≥ –û–ø–ª–∞—Ç–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞</h3>
                    <p class="text-gray-300 mb-4">–î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∞—É–∫—Ü–∏–æ–Ω–∞ –ø–µ—Ä–µ–≤–µ–¥–∏—Ç–µ <span class="text-[#D4AF37] font-bold text-xl">3 —Å–æ–º–æ–Ω–∏</span> –Ω–∞ –∫–æ—à–µ–ª–µ–∫:</p>
                    
                    <div class="bg-[#121212] border-2 border-[#D4AF37] rounded-lg p-5 mb-4 inline-block">
                        <p class="text-sm text-gray-400 mb-2">Alif / DC Money:</p>
                        <div class="flex items-center justify-center gap-3">
                            <p id="phoneNumber" class="text-3xl md:text-4xl font-bold text-[#D4AF37] tracking-wider">+992 888 788 181</p>
                            <button type="button" onclick="copyPhoneNumber()" class="px-5 py-3 bg-gradient-to-r from-[#D4AF37] to-[#FFD700] text-black font-bold rounded-xl hover:from-[#FFD700] hover:to-[#D4AF37] transition-all duration-300 shadow-lg shadow-[#D4AF37]/40 hover:shadow-[#FFD700]/50 hover:scale-110">
                                üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Receipt Upload -->
                <div>
                    <label for="{{ form.payment_receipt.id_for_label }}" class="block text-base font-bold text-[#D4AF37] mb-3 text-center">
                        üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞ –æ–ø–ª–∞—Ç—ã *
                    </label>
                    {{ form.payment_receipt }}
                    {% if form.payment_receipt.errors %}
                        <p class="text-red-500 text-sm mt-2 text-center">{{ form.payment_receipt.errors.0 }}</p>
                    {% endif %}
                    <p class="text-xs text-gray-500 mt-2 text-center">
                        –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –µ–≥–æ
                    </p>
                </div>
            </div>
            
            <!-- Title -->
            <div>
                <label for="{{ form.title.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    –ù–∞–∑–≤–∞–Ω–∏–µ *
                </label>
                {{ form.title }}
                {% if form.title.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ form.title.errors.0 }}</p>
                {% endif %}
            </div>
            
            <!-- Breed, Age, Gender - Grid (Conditional Fields) -->
            <div id="animalDetailsFields" class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <!-- Breed -->
                <div>
                    <label for="{{ form.breed.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                        –ü–æ—Ä–æ–¥–∞
                    </label>
                    {{ form.breed }}
                    {% if form.breed.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.breed.errors.0 }}</p>
                    {% endif %}
                </div>
                
                <!-- Age -->
                <div>
                    <label for="{{ form.age.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                        –í–æ–∑—Ä–∞—Å—Ç
                    </label>
                    {{ form.age }}
                    {% if form.age.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.age.errors.0 }}</p>
                    {% endif %}
                </div>
                
                <!-- Gender -->
                <div>
                    <label for="{{ form.gender.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                        –ü–æ–ª
                    </label>
                    {{ form.gender }}
                    {% if form.gender.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.gender.errors.0 }}</p>
                    {% endif %}
                </div>
                
                <!-- City -->
                <div>
                    <label for="{{ form.city.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                        üèôÔ∏è –ì–æ—Ä–æ–¥ *
                    </label>
                    {{ form.city }}
                    {% if form.city.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.city.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Transport Fields (Visible only for transport category) -->
            <div id="transportFields" class="hidden grid grid-cols-1 gap-4">
                <!-- Transport Type -->
                <div>
                    <label for="{{ form.transport_type.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                        üöó –¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
                    </label>
                    {% if form.transport_type %}
                        {{ form.transport_type }}
                    {% else %}
                        <input type="text" name="transport_type" placeholder="–ú–∞—Ä—à—Ä—É—Ç–∫–∞, –º–∏–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å –∏ —Ç.–¥." class="w-full px-4 py-3 rounded-lg border-2 border-gray-700 bg-[#121212] text-white focus:ring-2 focus:ring-[#D4AF37] focus:border-[#D4AF37]">
                    {% endif %}
                </div>
                
                <!-- Route From -->
                <div>
                    <label for="{{ form.route_from.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                        üìç –ú–∞—Ä—à—Ä—É—Ç –æ—Ç (–æ—Ç–∫—É–¥–∞)
                    </label>
                    {% if form.route_from %}
                        {{ form.route_from }}
                    {% else %}
                        <input type="text" name="route_from" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î—É—à–∞–Ω–±–µ" class="w-full px-4 py-3 rounded-lg border-2 border-gray-700 bg-[#121212] text-white focus:ring-2 focus:ring-[#D4AF37] focus:border-[#D4AF37]">
                    {% endif %}
                </div>
                
                <!-- Route To -->
                <div>
                    <label for="{{ form.route_to.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                        üéØ –ú–∞—Ä—à—Ä—É—Ç –¥–æ (–∫—É–¥–∞)
                    </label>
                    {% if form.route_to %}
                        {{ form.route_to }}
                    {% else %}
                        <input type="text" name="route_to" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –•—É–¥–∂–∞–Ω–¥" class="w-full px-4 py-3 rounded-lg border-2 border-gray-700 bg-[#121212] text-white focus:ring-2 focus:ring-[#D4AF37] focus:border-[#D4AF37]">
                    {% endif %}
                </div>
            </div>
            
            <!-- Gender (Livestock variant) -->
            <div class="hidden">
                <label for="{{ form.gender_livestock.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    –ü–æ–ª —Å–∫–æ—Ç–∞
                </label>
                {% if form.gender_livestock %}
                    {{ form.gender_livestock }}
                {% endif %}
            </div>
            
            <!-- Weight -->
            <div class="hidden">
                <label for="{{ form.weight.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    –í–µ—Å (–∫–≥)
                </label>
                {% if form.weight %}
                    {{ form.weight }}
                {% endif %}
            </div>
            
            <!-- Color Variety -->
            <div class="hidden">
                <label for="{{ form.color_variety.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    –†–∞—Å—Ü–≤–µ—Ç–∫–∞
                </label>
                {% if form.color_variety %}
                    {{ form.color_variety }}
                {% endif %}
            </div>
            
            <!-- Flight Duration -->
            <div class="hidden">
                <label for="{{ form.flight_duration.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª–µ—Ç–∞
                </label>
                {% if form.flight_duration %}
                    {{ form.flight_duration }}
                {% endif %}
            </div>
            
            <!-- Game Style -->
            <div class="hidden">
                <label for="{{ form.game_style.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    –°—Ç–∏–ª—å –∏–≥—Ä—ã
                </label>
                {% if form.game_style %}
                    {{ form.game_style }}
                {% endif %}
            </div>
            
            <!-- Health Status -->
            <div class="hidden">
                <label for="{{ form.health_status.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    –°—Ç–∞—Ç—É—Å –∑–¥–æ—Ä–æ–≤—å—è
                </label>
                {% if form.health_status %}
                    {{ form.health_status }}
                {% endif %}
            </div>

                <label for="{{ form.price.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    üí∞ –¶–µ–Ω–∞ (TJS) *
                </label>
                {{ form.price }}
                {% if form.price.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ form.price.errors.0 }}</p>
                {% endif %}
            </div>
            
            <!-- Auction Fields (Hidden by default) -->
            <div id="auctionFields" class="hidden space-y-4 border-2 border-[#D4AF37] rounded-lg p-5 bg-[#121212]">
                <h3 class="text-lg font-bold text-[#D4AF37] mb-3">üî® –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–∫—Ü–∏–æ–Ω–∞</h3>
                
                <!-- Start Price -->
                <div>
                    <label for="{{ form.start_price.id_for_label }}" class="block text-sm font-semibold text-gray-300 mb-2">
                        –ù–∞—á–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (TJS) *
                    </label>
                    {{ form.start_price }}
                    {% if form.start_price.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.start_price.errors.0 }}</p>
                    {% endif %}
                    <p class="text-xs text-gray-500 mt-1">–° —ç—Ç–æ–π —Å—É–º–º—ã –Ω–∞—á–Ω—É—Ç—Å—è —Ç–æ—Ä–≥–∏</p>
                </div>
                
                <!-- Auction End Date -->
                <div>
                    <label for="{{ form.auction_end_date.id_for_label }}" class="block text-sm font-semibold text-gray-300 mb-2">
                        –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞ *
                    </label>
                    {{ form.auction_end_date }}
                    {% if form.auction_end_date.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.auction_end_date.errors.0 }}</p>
                    {% endif %}
                    <p class="text-xs text-gray-500 mt-1">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è –∞—É–∫—Ü–∏–æ–Ω</p>
                </div>
            </div>
            
            <!-- Description -->
            <div>
                <label for="{{ form.description.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    –û–ø–∏—Å–∞–Ω–∏–µ *
                </label>
                {{ form.description }}
                {% if form.description.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ form.description.errors.0 }}</p>
                {% endif %}
            </div>
            
            <!-- SIMPLE PHOTO UPLOAD SYSTEM -->
            <div class="border-2 border-[#D4AF37] rounded-xl p-6 bg-gradient-to-br from-[#1E1E1E] to-[#121212]">
                
                <!-- MAIN PHOTO (REQUIRED) -->
                <div class="mb-6">
                    <label for="{{ form.main_photo.id_for_label }}" class="block text-lg font-bold text-[#D4AF37] mb-3">
                        üì∏ –ì–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                    </label>
                    <p class="text-sm text-gray-400 mb-3">–≠—Ç–æ —Ñ–æ—Ç–æ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ</p>
                    {{ form.main_photo }}
                    {% if form.main_photo.errors %}
                        <div class="mt-3 p-3 bg-red-900/30 border border-red-600 rounded-lg">
                            <p class="text-red-400 text-sm font-semibold">{{ form.main_photo.errors.0 }}</p>
                        </div>
                    {% endif %}
                </div>
                
                <!-- EXTRA PHOTOS (OPTIONAL, 0-4) -->
                <div>
                    <label class="block text-lg font-bold text-[#D4AF37] mb-3">
                        üñºÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –¥–æ 4 —à—Ç—É–∫)
                    </label>
                    <p class="text-sm text-gray-400 mb-3">–≠—Ç–∏ —Ñ–æ—Ç–æ –ø–æ—è–≤—è—Ç—Å—è –≤ –≥–∞–ª–µ—Ä–µ–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</p>
                    <input 
                        type="file" 
                        name="extra_images" 
                        multiple 
                        accept="image/*"
                        class="block w-full px-6 py-4 bg-gradient-to-r from-[#1E1E1E] to-[#2A2A2A] border-2 border-gray-600 rounded-xl text-gray-200 focus:border-[#D4AF37] focus:outline-none focus:ring-2 focus:ring-[#D4AF37]/50 hover:border-[#FFD700] transition-all cursor-pointer file:mr-4 file:py-2 file:px-6 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600"
                    >
                    <p class="text-xs text-gray-500 mt-2">
                        –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –æ—Ç 0 –¥–æ 4 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
                    </p>
                </div>
            </div>
            
            <!-- Contact Information Section -->
            <div class="border-t border-gray-700 pt-6 mt-6">
                <h3 class="text-xl font-bold text-[#D4AF37] mb-4">üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                
                <div class="space-y-4">
                    <!-- Phone -->
                    <div>
                        <label for="{{ form.phone.id_for_label }}" class="block text-sm font-semibold text-gray-300 mb-2">
                            –¢–µ–ª–µ—Ñ–æ–Ω *
                        </label>
                        {{ form.phone }}
                        {% if form.phone.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.phone.errors.0 }}</p>
                        {% endif %}
                        <p class="text-xs text-gray-500 mt-1">–§–æ—Ä–º–∞—Ç: +992XXXXXXXXX</p>
                    </div>
                    
                    <!-- WhatsApp -->
                    <div>
                        <label for="{{ form.whatsapp_number.id_for_label }}" class="block text-sm font-semibold text-gray-300 mb-2">
                            WhatsApp (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                        </label>
                        {{ form.whatsapp_number }}
                        {% if form.whatsapp_number.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.whatsapp_number.errors.0 }}</p>
                        {% endif %}
                        <p class="text-xs text-gray-500 mt-1">–ù–æ–º–µ—Ä WhatsApp (—Ñ–æ—Ä–º–∞—Ç: +992XXXXXXXXX)</p>
                    </div>
                    
                    <!-- Telegram -->
                    <div>
                        <label for="{{ form.telegram_username.id_for_label }}" class="block text-sm font-semibold text-gray-300 mb-2">
                            Telegram (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                        </label>
                        {{ form.telegram_username }}
                        {% if form.telegram_username.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.telegram_username.errors.0 }}</p>
                        {% endif %}
                        <p class="text-xs text-gray-500 mt-1">–í–∞—à Telegram username –±–µ–∑ @ (–Ω–∞–ø—Ä–∏–º–µ—Ä: username)</p>
                    </div>
                </div>
            </div>
            
            <!-- Video URL -->
            <div>
                <label for="{{ form.video_url.id_for_label }}" class="block text-sm font-semibold text-[#D4AF37] mb-2">
                    üé• –í–∏–¥–µ–æ YouTube (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                </label>
                {{ form.video_url }}
                {% if form.video_url.errors %}
                    <p class="text-red-500 text-sm mt-1">{{ form.video_url.errors.0 }}</p>
                {% endif %}
                <p class="text-xs text-gray-500 mt-1">
                    –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ
                </p>
            </div>
            
            <!-- VIP -->
            <div class="flex items-start space-x-3 p-4 bg-[#121212] rounded-lg">
                {{ form.is_vip }}
                <label for="{{ form.is_vip.id_for_label }}" class="text-sm text-gray-300 cursor-pointer">
                    <span class="font-semibold text-[#D4AF37] text-base">‚≠ê VIP —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ</span>
                    <span class="block text-xs text-gray-500 mt-1">–í–∞—à–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–æ –∑–æ–ª–æ—Ç–æ–π —Ä–∞–º–∫–æ–π –∏ –ø–æ–∫–∞–∑–∞–Ω–æ –ø–µ—Ä–≤—ã–º</span>
                    <a href="{% url 'vip_request' %}" class="text-[#D4AF37] hover:underline text-xs mt-1 inline-block">–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ VIP ‚Üí</a>
                </label>
            </div>
            
            <!-- Non-field errors -->
            {% if form.non_field_errors %}
                <div class="p-4 bg-red-900 border border-red-700 rounded-lg">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}
            
            <!-- Moderation Notice -->
            <div class="bg-blue-900/20 border border-blue-700/50 rounded-lg p-4">
                <div class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400 mr-3 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div>
                        <p class="text-sm text-blue-300 font-semibold mb-1">‚ÑπÔ∏è –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>
                        <p class="text-xs text-gray-400">
                            {% if animal %}
                            –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –º–æ–¥–µ—Ä–∞—Ü–∏—é.
                            {% else %}
                            –í–∞—à–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º (–æ–±—ã—á–Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤).
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Buttons -->
            <div class="flex flex-col sm:flex-row gap-3 pt-4">
                <button type="submit" id="submitButton" class="flex-1 px-8 py-4 bg-gradient-to-r from-[#D4AF37] to-[#FFD700] text-black font-bold text-lg rounded-xl hover:from-[#FFD700] hover:to-[#D4AF37] transition-all duration-300 shadow-lg shadow-[#D4AF37]/50 hover:shadow-[#FFD700]/60 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100">
                    {% if animal %}
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    {% else %}
                        üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
                    {% endif %}
                </button>
                <a href="{% if animal %}{% url 'animal_detail' animal.pk %}{% else %}{% url 'home' %}{% endif %}" class="flex-1 text-center px-8 py-4 border-2 border-gray-600 text-gray-300 font-bold text-lg rounded-xl hover:border-[#D4AF37] hover:text-[#D4AF37] hover:bg-[#2A2A2A] transition-all duration-300 hover:scale-105">
                    ‚ùå –û—Ç–º–µ–Ω–∞
                </a>
            </div>
        </form>
    </div>
</div>

<!-- üí´ Loading Spinner Overlay (Dark Luxury) -->
<div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center">
    <div class="text-center">
        <!-- Animated animal Icon -->
        <div class="mb-6 animate-bounce">
            <div class="text-8xl">ü¶Ö</div>
        </div>
        
        <!-- Loading Text -->
        <h2 class="text-3xl font-bold text-[#D4AF37] mb-3">
            –ó–∞–≥—Ä—É–∑–∫–∞...
        </h2>
        <p class="text-gray-300 text-lg">
            –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ
        </p>
        
        <!-- Spinner Animation -->
        <div class="mt-6 flex justify-center">
            <div class="w-16 h-16 border-4 border-[#D4AF37] border-t-transparent rounded-full animate-spin"></div>
        </div>
        
        <!-- Progress Hint -->
        <p class="text-sm text-gray-500 mt-4">
            –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...
        </p>
    </div>
</div>

<script>
function toggleAuctionFields() {
    const listingTypeInputs = document.querySelectorAll('input[name="listing_type"]');
    let selectedType = 'fixed';
    
    listingTypeInputs.forEach(input => {
        if (input.checked) {
            selectedType = input.value;
        }
    });
    
    const auctionWarning = document.getElementById('auctionWarning');
    const paymentBox = document.getElementById('paymentBox');
    const auctionFields = document.getElementById('auctionFields');
    const fixedPriceField = document.getElementById('fixedPriceField');
    
    // Get form fields
    const priceInput = document.querySelector('input[name="price"]');
    const startPriceInput = document.querySelector('input[name="start_price"]');
    const auctionEndDateInput = document.querySelector('input[name="auction_end_date"]');
    const paymentReceiptInput = document.querySelector('input[name="payment_receipt"]');
    
    if (selectedType === 'auction') {
        // Show auction elements
        auctionWarning.classList.remove('hidden');
        paymentBox.classList.remove('hidden');
        auctionFields.classList.remove('hidden');
        fixedPriceField.classList.add('hidden');
        
        // Remove required from price, add to auction fields
        if (priceInput) priceInput.removeAttribute('required');
        if (startPriceInput) startPriceInput.setAttribute('required', 'required');
        if (auctionEndDateInput) auctionEndDateInput.setAttribute('required', 'required');
        if (paymentReceiptInput) paymentReceiptInput.setAttribute('required', 'required');
    } else {
        // Show fixed price elements
        auctionWarning.classList.add('hidden');
        paymentBox.classList.add('hidden');
        auctionFields.classList.add('hidden');
        fixedPriceField.classList.remove('hidden');
        
        // Add required to price, remove from auction fields
        if (priceInput) priceInput.setAttribute('required', 'required');
        if (startPriceInput) startPriceInput.removeAttribute('required');
        if (auctionEndDateInput) auctionEndDateInput.removeAttribute('required');
        if (paymentReceiptInput) paymentReceiptInput.removeAttribute('required');
    }
}

function copyPhoneNumber() {
    const phoneNumber = '+992888788181';
    navigator.clipboard.writeText(phoneNumber).then(function() {
        // Show success feedback
        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
        button.classList.add('bg-green-600');
        button.classList.remove('bg-[#D4AF37]');
        
        setTimeout(function() {
            button.innerHTML = originalText;
            button.classList.remove('bg-green-600');
            button.classList.add('bg-[#D4AF37]');
        }, 2000);
    }, function(err) {
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é: +992 888 788 181');
    });
}

//üí´ Loading Spinner Handler
function setupLoadingSpinner() {
    const form = document.querySelector('form');
    const submitButton = document.getElementById('submitButton');
    const loadingOverlay = document.getElementById('loadingOverlay');
    
    if (!form || !submitButton || !loadingOverlay) return;
    
    form.addEventListener('submit', function(e) {
        console.log('Form submit triggered');
        
        // Check main image is uploaded
        const mainImage = document.querySelector('input[name="image"]');
        if (mainImage && (!mainImage.files || mainImage.files.length === 0)) {
            e.preventDefault();
            alert('‚ùå –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≥–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ!');
            return;
        }
        
        // Validate auction fields if auction type is selected
        const listingType = document.querySelector('input[name="listing_type"]:checked');
        console.log('Listing type:', listingType ? listingType.value : 'none');
        
        if (listingType && listingType.value === 'auction') {
            const startPrice = document.querySelector('input[name="start_price"]');
            const auctionEndDate = document.querySelector('input[name="auction_end_date"]');
            const paymentReceipt = document.querySelector('input[name="payment_receipt"]');
            
            let missingFields = [];
            
            if (!startPrice || !startPrice.value) {
                missingFields.push('–ù–∞—á–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞');
            }
            if (!auctionEndDate || !auctionEndDate.value) {
                missingFields.push('–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è');
            }
            if (!paymentReceipt || !paymentReceipt.files || paymentReceipt.files.length === 0) {
                missingFields.push('–ß–µ–∫ –æ–ø–ª–∞—Ç—ã');
            }
            
            if (missingFields.length > 0) {
                e.preventDefault();
                alert('‚ùå –î–ª—è –∞—É–∫—Ü–∏–æ–Ω–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:\n\n‚Ä¢ ' + missingFields.join('\n‚Ä¢ '));
                return;
            }
        }
        
        console.log('Form validation passed, submitting...');
        
        // Show loading overlay
        loadingOverlay.classList.remove('hidden');
        
        // Disable submit button
        submitButton.disabled = true;
        submitButton.textContent = '‚öôÔ∏è –û—Ç–ø—Ä–∞–≤–∫–∞...';
    });
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleAuctionFields();
    setupLoadingSpinner();
    console.log('Page loaded, scripts initialized');
    
    // –ó–ê–î–ê–ß–ê 2: Initialize dynamic form fields
    if (window.FormFieldManager) {
        FormFieldManager.initialize();
    }
});
</script>

<!-- –ó–ê–î–ê–ß–ê 2: Dynamic Form Fields Management -->
<script src="{% static 'js/form-fields.js' %}"></script>

{% endblock %}

