# ‚úÖ –ü–û–õ–ù–ê–Ø –ü–ï–†–ï–†–ê–ë–û–¢–ö–ê –°–ò–°–¢–ï–ú–´ –ó–ê–ì–†–£–ó–ö–ò –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1Ô∏è‚É£ **core/models.py** ‚úÖ –£–ñ–ï –ö–û–†–†–ï–ö–¢–ù–´–ï
```python
class Pigeon(models.Model):
    # –ì–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ (–æ–±–ª–æ–∂–∫–∞)
    image = models.ImageField(upload_to='pigeons/', verbose_name='–§–æ—Ç–æ')
    # ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è ...

class PigeonImage(models.Model):
    # –ì–∞–ª–µ—Ä–µ—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ
    pigeon = models.ForeignKey(Pigeon, related_name='images', on_delete=models.CASCADE)
    image = models.ImageField(upload_to='pigeon_images/', verbose_name='–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ')
    order = models.PositiveSmallIntegerField(default=0)
```

---

### 2Ô∏è‚É£ **core/forms.py** ‚úÖ –ü–ï–†–ï–ü–ò–°–ê–ù

**–ö–∞—Å—Ç–æ–º–Ω—ã–π –≤–∏–¥–∂–µ—Ç:**
```python
class MultipleFileInput(forms.ClearableFileInput):
    """Custom widget to support multiple file uploads"""
    allow_multiple_selected = True
```

**–§–æ—Ä–º–∞ PigeonForm:**
```python
class PigeonForm(forms.ModelForm):
    # –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Ñ–æ—Ç–æ
    photos = forms.FileField(
        required=True,
        label='üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≥–æ–ª—É–±—è',
        help_text='–ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ—Ç 1 –¥–æ 5 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π. –ü–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ –±—É–¥–µ—Ç –æ–±–ª–æ–∂–∫–æ–π.',
        widget=MultipleFileInput(attrs={
            'accept': 'image/*',
            'multiple': True  # –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!
        })
    )
    
    class Meta:
        model = Pigeon
        # ‚ö†Ô∏è –í–ê–ñ–ù–û: 'image' –£–ë–†–ê–ù–û –∏–∑ fields (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é)
        fields = ['title', 'breed', 'game_type', 'sex', 'city', 'price', 
                  'description', 'video_url', 'phone', 'whatsapp_number', 
                  'telegram_username', 'is_vip', 'listing_type', 
                  'start_price', 'auction_end_date', 'payment_receipt']
```

---

### 3Ô∏è‚É£ **core/views.py** ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –ü–ï–†–ï–ü–ò–°–ê–ù

**–§—É–Ω–∫—Ü–∏—è add_pigeon - –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê:**

```python
@login_required
def add_pigeon(request):
    if request.method == 'POST':
        form = PigeonForm(request.POST, request.FILES)
        
        # –®–ê–ì 1: –ü–æ–ª—É—á–∞–µ–º —Ñ–∞–π–ª—ã –î–û –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã
        files = request.FILES.getlist('photos')
        
        # –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
        if not files or len(files) == 0:
            messages.error(request, '‚ùå –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ñ–æ—Ç–æ!')
            return render(request, 'core/add_pigeon.html', {'form': form})
        
        if len(files) > 5:
            messages.error(request, f'‚ùå –ú–∞–∫—Å–∏–º—É–º 5 —Ñ–æ—Ç–æ! –í—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏ {len(files)}.')
            return render(request, 'core/add_pigeon.html', {'form': form})
        
        # –®–ê–ì 3: –í–∞–ª–∏–¥–∏—Ä—É–µ–º —Ñ–æ—Ä–º—É
        if form.is_valid():
            pigeon = form.save(commit=False)
            pigeon.owner = request.user
            pigeon.is_approved = False
            
            # –®–ê–ì 4: –ü–ï–†–í–û–ï –§–û–¢–û ‚Üí –û–ë–õ–û–ñ–ö–ê (pigeon.image)
            pigeon.image = files[0]
            
            # –î–ª—è –∞—É–∫—Ü–∏–æ–Ω–æ–≤
            if pigeon.listing_type == 'auction' and pigeon.start_price:
                pigeon.current_price = pigeon.start_price
            
            # –®–ê–ì 5: –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥–æ–ª—É–±—è
            pigeon.save()
            
            # –®–ê–ì 6: –û–°–¢–ê–õ–¨–ù–´–ï –§–û–¢–û ‚Üí –ì–ê–õ–ï–†–ï–Ø (PigeonImage)
            gallery_count = 0
            if len(files) > 1:
                for index, image_file in enumerate(files[1:], start=0):
                    PigeonImage.objects.create(
                        pigeon=pigeon,
                        image=image_file,
                        order=index
                    )
                    gallery_count += 1
            
            # –®–ê–ì 7: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
            total_photos = len(files)
            photo_info = f"{total_photos} —Ñ–æ—Ç–æ" if total_photos > 1 else "1 —Ñ–æ—Ç–æ"
            gallery_info = f" (1 –æ–±–ª–æ–∂–∫–∞ + {gallery_count} –≤ –≥–∞–ª–µ—Ä–µ–µ)" if gallery_count > 0 else " (–æ–±–ª–æ–∂–∫–∞)"
            
            messages.success(request, f'‚úÖ –°–æ–∑–¥–∞–Ω–æ —Å {photo_info}{gallery_info}!')
            return redirect('my_pigeons')
        else:
            print("–û–®–ò–ë–ö–ò –§–û–†–ú–´:", form.errors)
            messages.error(request, '‚ùå –û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–µ.')
    else:
        form = PigeonForm()
    
    return render(request, 'core/add_pigeon.html', {'form': form})
```

---

### 4Ô∏è‚É£ **templates/core/add_pigeon.html** ‚úÖ –£–ñ–ï –ö–û–†–†–ï–ö–¢–ù–´–ô

```html
<!-- ‚úÖ enctype —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω -->
<form method="post" enctype="multipart/form-data" class="space-y-6">
    {% csrf_token %}
    
    <!-- ‚úÖ –ü–æ–ª–µ photos —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è -->
    <div class="border-2 border-[#D4AF37] rounded-xl p-6">
        <label for="{{ form.photos.id_for_label }}">
            {{ form.photos.label }}
        </label>
        {{ form.photos }}
        
        {% if form.photos.errors %}
            <p class="text-red-400">{{ form.photos.errors.0 }}</p>
        {% endif %}
    </div>
    
    <button type="submit">üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
</form>
```

---

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ó–∞–≥—Ä—É–∑–∫–∞ 3 —Ñ–æ—Ç–æ:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç 3 —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ `<input type="file" multiple>`
2. `request.FILES.getlist('photos')` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `[file1, file2, file3]`
3. **file1** ‚Üí `pigeon.image` (–æ–±–ª–æ–∂–∫–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ)
4. **file2, file3** ‚Üí `PigeonImage` (–≥–∞–ª–µ—Ä–µ—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–µ—Ç–∞–ª–∏)

### –í–∞–ª–∏–¥–∞—Ü–∏—è:
- ‚úÖ –ú–∏–Ω–∏–º—É–º: 1 —Ñ–æ—Ç–æ
- ‚úÖ –ú–∞–∫—Å–∏–º—É–º: 5 —Ñ–æ—Ç–æ
- ‚úÖ –ü–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–±–ª–æ–∂–∫–æ–π

---

## üöÄ –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê

```powershell
# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
.\venv\Scripts\Activate.ps1

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
python manage.py runserver
```

**–û—Ç–∫—Ä–æ–π—Ç–µ:** http://127.0.0.1:8000/

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ 2-3 —Ñ–æ—Ç–æ
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É
4. –ù–∞–∂–º–∏—Ç–µ "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å"
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - –ü–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ –æ–±–ª–æ–∂–∫–∞ –≤ —Å–ø–∏—Å–∫–µ
   - –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ –≤ –≥–∞–ª–µ—Ä–µ–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–µ—Ç–∞–ª–∏
   - –í –∞–¥–º–∏–Ω–∫–µ –≤–∏–¥–Ω—ã –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

---

## üîß –û–¢–õ–ê–î–ö–ê

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

### 1. –ö–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞:
```python
print("FILES:", request.FILES.getlist('photos'))
print("FORM ERRORS:", form.errors)
```

### 2. –ë—Ä–∞—É–∑–µ—Ä (DevTools):
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `<input>` –∏–º–µ–µ—Ç `multiple="true"`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `<form>` –∏–º–µ–µ—Ç `enctype="multipart/form-data"`

### 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
```python
# –í Django shell
from core.models import Pigeon, PigeonImage

pigeon = Pigeon.objects.last()
print(f"Cover: {pigeon.image}")
print(f"Gallery: {pigeon.images.all()}")
```

---

## üìù –ö–õ–Æ–ß–ï–í–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|------|-----------|--------|
| `core/forms.py` | –£–±—Ä–∞–Ω–æ 'image' –∏–∑ Meta.fields | ‚úÖ |
| `core/forms.py` | –î–æ–±–∞–≤–ª–µ–Ω MultipleFileInput | ‚úÖ |
| `core/forms.py` | –ü–æ–ª–µ photos —Å multiple=True | ‚úÖ |
| `core/views.py` | files = request.FILES.getlist() | ‚úÖ |
| `core/views.py` | pigeon.image = files[0] | ‚úÖ |
| `core/views.py` | PigeonImage –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö | ‚úÖ |
| `templates/...` | enctype="multipart/form-data" | ‚úÖ |
| `templates/...` | form.photos –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π input | ‚úÖ |

---

## üéâ –ì–û–¢–û–í–û!

–°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!
